const{getFooterMessage}=require("./messages_footer.cjs");function buildAIFooter(workflowName,runUrl){return"\n\n"+getFooterMessage({workflowName,runUrl})}function buildIslandStartMarker(runId){return`\x3c!-- gh-aw-island-start:${runId} --\x3e`}function buildIslandEndMarker(runId){return`\x3c!-- gh-aw-island-end:${runId} --\x3e`}function findIsland(body,runId){const startMarker=buildIslandStartMarker(runId),endMarker=buildIslandEndMarker(runId),startIndex=body.indexOf(startMarker);if(-1===startIndex)return{found:!1,startIndex:-1,endIndex:-1};const endIndex=body.indexOf(endMarker,startIndex);return-1===endIndex?{found:!1,startIndex:-1,endIndex:-1}:{found:!0,startIndex,endIndex:endIndex+endMarker.length}}function updatePRBody(params){const{currentBody,newContent,operation,workflowName,runUrl,runId}=params,aiFooter=buildAIFooter(workflowName,runUrl);if("replace"===operation)return core.info("Operation: replace (full body replacement)"),newContent;if("replace-island"===operation){const island=findIsland(currentBody,runId);if(island.found){core.info(`Operation: replace-island (updating existing island for run ${runId})`);const islandContent=`${buildIslandStartMarker(runId)}\n${newContent}${aiFooter}\n${buildIslandEndMarker(runId)}`;return currentBody.substring(0,island.startIndex)+islandContent+currentBody.substring(island.endIndex)}return core.info(`Operation: replace-island (island not found for run ${runId}, falling back to append)`),currentBody+`\n\n---\n\n${buildIslandStartMarker(runId)}\n${newContent}${aiFooter}\n${buildIslandEndMarker(runId)}`}return"prepend"===operation?(core.info("Operation: prepend (add to start with separator)"),`${newContent}${aiFooter}\n\n---\n\n`+currentBody):(core.info("Operation: append (add to end with separator)"),currentBody+`\n\n---\n\n${newContent}${aiFooter}`)}module.exports={buildAIFooter,buildIslandStartMarker,buildIslandEndMarker,findIsland,updatePRBody};
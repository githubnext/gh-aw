const crypto=require("crypto"),TEMPORARY_ID_PATTERN=/#(aw_[0-9a-f]{12})/gi;function generateTemporaryId(){return"aw_"+crypto.randomBytes(6).toString("hex")}function isTemporaryId(value){return"string"==typeof value&&/^aw_[0-9a-f]{12}$/i.test(value)}function normalizeTemporaryId(tempId){return String(tempId).toLowerCase()}function replaceTemporaryIdReferences(text,tempIdMap,currentRepo){return text.replace(TEMPORARY_ID_PATTERN,(match,tempId)=>{const resolved=tempIdMap.get(normalizeTemporaryId(tempId));return void 0!==resolved?currentRepo&&resolved.repo===currentRepo?`#${resolved.number}`:`${resolved.repo}#${resolved.number}`:match})}function replaceTemporaryIdReferencesLegacy(text,tempIdMap){return text.replace(TEMPORARY_ID_PATTERN,(match,tempId)=>{const issueNumber=tempIdMap.get(normalizeTemporaryId(tempId));return void 0!==issueNumber?`#${issueNumber}`:match})}function loadTemporaryIdMap(){const mapJson=process.env.GH_AW_TEMPORARY_ID_MAP;if(!mapJson||"{}"===mapJson)return new Map;try{const mapObject=JSON.parse(mapJson),result=new Map;for(const[key,value]of Object.entries(mapObject)){const normalizedKey=normalizeTemporaryId(key);if("number"==typeof value){const contextRepo=`${context.repo.owner}/${context.repo.repo}`;result.set(normalizedKey,{repo:contextRepo,number:value})}else"object"==typeof value&&null!==value&&"repo"in value&&"number"in value&&result.set(normalizedKey,{repo:String(value.repo),number:Number(value.number)})}return result}catch(error){return"undefined"!=typeof core&&core.warning(`Failed to parse temporary ID map: ${error instanceof Error?error.message:String(error)}`),new Map}}function resolveIssueNumber(value,temporaryIdMap){if(null==value)return{resolved:null,wasTemporaryId:!1,errorMessage:"Issue number is missing"};const valueStr=String(value);if(isTemporaryId(valueStr)){const resolvedPair=temporaryIdMap.get(normalizeTemporaryId(valueStr));return void 0!==resolvedPair?{resolved:resolvedPair,wasTemporaryId:!0,errorMessage:null}:{resolved:null,wasTemporaryId:!0,errorMessage:`Temporary ID '${valueStr}' not found in map. Ensure the issue was created before linking.`}}const issueNumber="number"==typeof value?value:parseInt(valueStr,10);return isNaN(issueNumber)||issueNumber<=0?{resolved:null,wasTemporaryId:!1,errorMessage:`Invalid issue number: ${value}`}:{resolved:{repo:"undefined"!=typeof context?`${context.repo.owner}/${context.repo.repo}`:"",number:issueNumber},wasTemporaryId:!1,errorMessage:null}}function serializeTemporaryIdMap(tempIdMap){const obj=Object.fromEntries(tempIdMap);return JSON.stringify(obj)}module.exports={TEMPORARY_ID_PATTERN,generateTemporaryId,isTemporaryId,normalizeTemporaryId,replaceTemporaryIdReferences,replaceTemporaryIdReferencesLegacy,loadTemporaryIdMap,resolveIssueNumber,serializeTemporaryIdMap};
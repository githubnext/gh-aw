const fs=require("fs"),path=require("path");function loadConfig(server){const configPath=process.env.GH_AW_SAFE_OUTPUTS_CONFIG_PATH||"/tmp/gh-aw/safeoutputs/config.json";let safeOutputsConfigRaw;server.debug(`Reading config from file: ${configPath}`);try{if(fs.existsSync(configPath)){server.debug(`Config file exists at: ${configPath}`);const configFileContent=fs.readFileSync(configPath,"utf8");server.debug(`Config file content length: ${configFileContent.length} characters`),server.debug("Config file read successfully, attempting to parse JSON"),safeOutputsConfigRaw=JSON.parse(configFileContent),server.debug(`Successfully parsed config from file with ${Object.keys(safeOutputsConfigRaw).length} configuration keys`)}else server.debug(`Config file does not exist at: ${configPath}`),server.debug("Using minimal default configuration"),safeOutputsConfigRaw={}}catch(error){server.debug(`Error reading config file: ${error instanceof Error?error.message:String(error)}`),server.debug("Falling back to empty configuration"),safeOutputsConfigRaw={}}const safeOutputsConfig=Object.fromEntries(Object.entries(safeOutputsConfigRaw).map(([k,v])=>[k.replace(/-/g,"_"),v]));server.debug(`Final processed config: ${JSON.stringify(safeOutputsConfig)}`);const outputFile=process.env.GH_AW_SAFE_OUTPUTS||"/tmp/gh-aw/safeoutputs/outputs.jsonl";process.env.GH_AW_SAFE_OUTPUTS||server.debug(`GH_AW_SAFE_OUTPUTS not set, using default: ${outputFile}`);const outputDir=path.dirname(outputFile);return fs.existsSync(outputDir)||(server.debug(`Creating output directory: ${outputDir}`),fs.mkdirSync(outputDir,{recursive:!0})),{config:safeOutputsConfig,outputFile}}module.exports={loadConfig};
const{createServer,registerTool,normalizeTool,start}=require("./mcp_server_core.cjs"),{createAppendFunction}=require("./safe_outputs_append.cjs"),{createHandlers}=require("./safe_outputs_handlers.cjs"),{attachHandlers,registerPredefinedTools,registerDynamicTools}=require("./safe_outputs_tools_loader.cjs"),{bootstrapSafeOutputsServer,cleanupConfigFile}=require("./safe_outputs_bootstrap.cjs");function startSafeOutputsServer(options={}){const MCP_LOG_DIR=options.logDir||process.env.GH_AW_MCP_LOG_DIR,server=createServer({name:"safeoutputs",version:"1.0.0"},{logDir:MCP_LOG_DIR}),{config:safeOutputsConfig,outputFile,tools:ALL_TOOLS}=bootstrapSafeOutputsServer(server),appendSafeOutput=createAppendFunction(outputFile),handlers=createHandlers(server,appendSafeOutput,safeOutputsConfig),{defaultHandler}=handlers,toolsWithHandlers=attachHandlers(ALL_TOOLS,handlers);if(server.debug(`  output file: ${outputFile}`),server.debug(`  config: ${JSON.stringify(safeOutputsConfig)}`),registerPredefinedTools(server,toolsWithHandlers,safeOutputsConfig,registerTool,normalizeTool),registerDynamicTools(server,toolsWithHandlers,safeOutputsConfig,outputFile,registerTool,normalizeTool),server.debug(`  tools: ${Object.keys(server.tools).join(", ")}`),!Object.keys(server.tools).length)throw new Error("No tools enabled in configuration");start(server,{defaultHandler})}if(require.main===module)try{startSafeOutputsServer()}catch(error){console.error(`Error starting safe-outputs server: ${error instanceof Error?error.message:String(error)}`),process.exit(1)}module.exports={startSafeOutputsServer};
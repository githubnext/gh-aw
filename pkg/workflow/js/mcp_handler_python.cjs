const{execFile}=require("child_process");function createPythonHandler(server,toolName,scriptPath,timeoutSeconds=60){return async args=>{server.debug(`  [${toolName}] Invoking Python handler: ${scriptPath}`),server.debug(`  [${toolName}] Python handler args: ${JSON.stringify(args)}`),server.debug(`  [${toolName}] Timeout: ${timeoutSeconds}s`);const inputJson=JSON.stringify(args||{});return server.debug(`  [${toolName}] Input JSON (${inputJson.length} bytes): ${inputJson.substring(0,200)}${inputJson.length>200?"...":""}`),new Promise((resolve,reject)=>{server.debug(`  [${toolName}] Executing Python script...`);const child=execFile("python3",[scriptPath],{env:process.env,timeout:1e3*timeoutSeconds,maxBuffer:10485760},(error,stdout,stderr)=>{if(stdout&&server.debug(`  [${toolName}] stdout: ${stdout.substring(0,500)}${stdout.length>500?"...":""}`),stderr&&server.debug(`  [${toolName}] stderr: ${stderr.substring(0,500)}${stderr.length>500?"...":""}`),error)return server.debugError(`  [${toolName}] Python script error: `,error),void reject(error);let result;try{result=stdout&&stdout.trim()?JSON.parse(stdout.trim()):{stdout:stdout||"",stderr:stderr||""}}catch(parseError){server.debug(`  [${toolName}] Output is not JSON, returning as text`),result={stdout:stdout||"",stderr:stderr||""}}server.debug(`  [${toolName}] Python handler completed successfully`),resolve({content:[{type:"text",text:JSON.stringify(result)}]})});child.stdin&&(child.stdin.write(inputJson),child.stdin.end())})}}module.exports={createPythonHandler};
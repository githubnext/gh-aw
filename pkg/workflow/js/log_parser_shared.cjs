const MAX_TOOL_OUTPUT_LENGTH=256,MAX_STEP_SUMMARY_SIZE=1024e3,MAX_BASH_COMMAND_DISPLAY_LENGTH=40,SIZE_LIMIT_WARNING="\n\nâš ï¸ *Step summary size limit reached. Additional content truncated.*\n\n";class StepSummaryTracker{constructor(maxSize=1024e3){this.currentSize=0,this.maxSize=maxSize,this.limitReached=!1}add(content){if(this.limitReached)return!1;const contentSize=Buffer.byteLength(content,"utf8");return this.currentSize+contentSize>this.maxSize?(this.limitReached=!0,!1):(this.currentSize+=contentSize,!0)}isLimitReached(){return this.limitReached}getSize(){return this.currentSize}reset(){this.currentSize=0,this.limitReached=!1}}function formatDuration(ms){if(!ms||ms<=0)return"";const seconds=Math.round(ms/1e3);if(seconds<60)return`${seconds}s`;const minutes=Math.floor(seconds/60),remainingSeconds=seconds%60;return 0===remainingSeconds?`${minutes}m`:`${minutes}m ${remainingSeconds}s`}function formatBashCommand(command){if(!command)return"";let formatted=command.replace(/\n/g," ").replace(/\r/g," ").replace(/\t/g," ").replace(/\s+/g," ").trim();return formatted=formatted.replace(/`/g,"\\`"),formatted.length>300&&(formatted=formatted.substring(0,300)+"..."),formatted}function truncateString(str,maxLength){return str?str.length<=maxLength?str:str.substring(0,maxLength)+"...":""}function estimateTokens(text){return text?Math.ceil(text.length/4):0}function formatMcpName(toolName){if(toolName.startsWith("mcp__")){const parts=toolName.split("__");if(parts.length>=3)return`${parts[1]}::${parts.slice(2).join("_")}`}return toolName}function isLikelyCustomAgent(toolName){return!(!toolName||"string"!=typeof toolName||!toolName.includes("-")||toolName.includes("__")||toolName.toLowerCase().startsWith("safe")||!/^[a-z0-9]+(-[a-z0-9]+)+$/.test(toolName))}function generateConversationMarkdown(logEntries,options){const{formatToolCallback,formatInitCallback,summaryTracker}=options,toolUsePairs=new Map;for(const entry of logEntries)if("user"===entry.type&&entry.message?.content)for(const content of entry.message.content)"tool_result"===content.type&&content.tool_use_id&&toolUsePairs.set(content.tool_use_id,content);let markdown="",sizeLimitReached=!1;function addContent(content){return summaryTracker&&!summaryTracker.add(content)?(sizeLimitReached=!0,!1):(markdown+=content,!0)}const initEntry=logEntries.find(entry=>"system"===entry.type&&"init"===entry.subtype);if(initEntry&&formatInitCallback){if(!addContent("## ðŸš€ Initialization\n\n"))return{markdown,commandSummary:[],sizeLimitReached};const initResult=formatInitCallback(initEntry);if("string"==typeof initResult){if(!addContent(initResult))return{markdown,commandSummary:[],sizeLimitReached}}else if(initResult&&initResult.markdown&&!addContent(initResult.markdown))return{markdown,commandSummary:[],sizeLimitReached};if(!addContent("\n"))return{markdown,commandSummary:[],sizeLimitReached}}if(!addContent("\n## ðŸ¤– Reasoning\n\n"))return{markdown,commandSummary:[],sizeLimitReached};for(const entry of logEntries){if(sizeLimitReached)break;if("assistant"===entry.type&&entry.message?.content)for(const content of entry.message.content){if(sizeLimitReached)break;if("text"===content.type&&content.text){const text=content.text.trim();if(text&&text.length>0&&!addContent(text+"\n\n"))break}else if("tool_use"===content.type){const toolMarkdown=formatToolCallback(content,toolUsePairs.get(content.id));if(toolMarkdown&&!addContent(toolMarkdown))break}}}if(sizeLimitReached)return markdown+=SIZE_LIMIT_WARNING,{markdown,commandSummary:[],sizeLimitReached};if(!addContent("## ðŸ¤– Commands and Tools\n\n"))return markdown+=SIZE_LIMIT_WARNING,{markdown,commandSummary:[],sizeLimitReached:!0};const commandSummary=[];for(const entry of logEntries)if("assistant"===entry.type&&entry.message?.content)for(const content of entry.message.content)if("tool_use"===content.type){const toolName=content.name,input=content.input||{};if(["Read","Write","Edit","MultiEdit","LS","Grep","Glob","TodoWrite"].includes(toolName))continue;const toolResult=toolUsePairs.get(content.id);let statusIcon="â“";if(toolResult&&(statusIcon=!0===toolResult.is_error?"âŒ":"âœ…"),"Bash"===toolName){const formattedCommand=formatBashCommand(input.command||"");commandSummary.push(`* ${statusIcon} \`${formattedCommand}\``)}else if(toolName.startsWith("mcp__")){const mcpName=formatMcpName(toolName);commandSummary.push(`* ${statusIcon} \`${mcpName}(...)\``)}else commandSummary.push(`* ${statusIcon} ${toolName}`)}if(commandSummary.length>0){for(const cmd of commandSummary)if(!addContent(`${cmd}\n`))return markdown+=SIZE_LIMIT_WARNING,{markdown,commandSummary,sizeLimitReached:!0}}else if(!addContent("No commands or tools used.\n"))return markdown+=SIZE_LIMIT_WARNING,{markdown,commandSummary,sizeLimitReached:!0};return{markdown,commandSummary,sizeLimitReached}}function generateInformationSection(lastEntry,options={}){const{additionalInfoCallback}=options;let markdown="\n## ðŸ“Š Information\n\n";if(!lastEntry)return markdown;if(lastEntry.num_turns&&(markdown+=`**Turns:** ${lastEntry.num_turns}\n\n`),lastEntry.duration_ms){const durationSec=Math.round(lastEntry.duration_ms/1e3);markdown+=`**Duration:** ${Math.floor(durationSec/60)}m ${durationSec%60}s\n\n`}if(lastEntry.total_cost_usd&&(markdown+=`**Total Cost:** $${lastEntry.total_cost_usd.toFixed(4)}\n\n`),additionalInfoCallback){const additionalInfo=additionalInfoCallback(lastEntry);additionalInfo&&(markdown+=additionalInfo)}if(lastEntry.usage){const usage=lastEntry.usage;if(usage.input_tokens||usage.output_tokens){const totalTokens=(usage.input_tokens||0)+(usage.output_tokens||0)+(usage.cache_creation_input_tokens||0)+(usage.cache_read_input_tokens||0);markdown+="**Token Usage:**\n",totalTokens>0&&(markdown+=`- Total: ${totalTokens.toLocaleString()}\n`),usage.input_tokens&&(markdown+=`- Input: ${usage.input_tokens.toLocaleString()}\n`),usage.cache_creation_input_tokens&&(markdown+=`- Cache Creation: ${usage.cache_creation_input_tokens.toLocaleString()}\n`),usage.cache_read_input_tokens&&(markdown+=`- Cache Read: ${usage.cache_read_input_tokens.toLocaleString()}\n`),usage.output_tokens&&(markdown+=`- Output: ${usage.output_tokens.toLocaleString()}\n`),markdown+="\n"}}return lastEntry.permission_denials&&lastEntry.permission_denials.length>0&&(markdown+=`**Permission Denials:** ${lastEntry.permission_denials.length}\n\n`),markdown}function formatMcpParameters(input){const keys=Object.keys(input);if(0===keys.length)return"";const paramStrs=[];for(const key of keys.slice(0,4)){const value=String(input[key]||"");paramStrs.push(`${key}: ${truncateString(value,40)}`)}return keys.length>4&&paramStrs.push("..."),paramStrs.join(", ")}function formatInitializationSummary(initEntry,options={}){const{mcpFailureCallback,modelInfoCallback,includeSlashCommands=!1}=options;let markdown="";const mcpFailures=[];if(initEntry.model&&(markdown+=`**Model:** ${initEntry.model}\n\n`),modelInfoCallback){const modelInfo=modelInfoCallback(initEntry);modelInfo&&(markdown+=modelInfo)}if(initEntry.session_id&&(markdown+=`**Session ID:** ${initEntry.session_id}\n\n`),initEntry.cwd&&(markdown+=`**Working Directory:** ${initEntry.cwd.replace(/^\/home\/runner\/work\/[^\/]+\/[^\/]+/,".")}\n\n`),initEntry.mcp_servers&&Array.isArray(initEntry.mcp_servers)){markdown+="**MCP Servers:**\n";for(const server of initEntry.mcp_servers)if(markdown+=`- ${"connected"===server.status?"âœ…":"failed"===server.status?"âŒ":"â“"} ${server.name} (${server.status})\n`,"failed"===server.status&&(mcpFailures.push(server.name),mcpFailureCallback)){const failureDetails=mcpFailureCallback(server);failureDetails&&(markdown+=failureDetails)}markdown+="\n"}if(initEntry.tools&&Array.isArray(initEntry.tools)){markdown+="**Available Tools:**\n";const categories={Core:[],"File Operations":[],Builtin:[],"Safe Outputs":[],"Safe Inputs":[],"Git/GitHub":[],Playwright:[],Serena:[],MCP:[],"Custom Agents":[],Other:[]},builtinTools=["bash","write_bash","read_bash","stop_bash","list_bash","grep","glob","view","create","edit","store_memory","code_review","codeql_checker","report_progress","report_intent","gh-advisory-database"],internalTools=["fetch_copilot_cli_documentation"];for(const tool of initEntry.tools){const toolLower=tool.toLowerCase();if(["Task","Bash","BashOutput","KillBash","ExitPlanMode"].includes(tool))categories.Core.push(tool);else if(["Read","Edit","MultiEdit","Write","LS","Grep","Glob","NotebookEdit"].includes(tool))categories["File Operations"].push(tool);else if(builtinTools.includes(toolLower)||internalTools.includes(toolLower))categories.Builtin.push(tool);else if(tool.startsWith("safeoutputs-")||tool.startsWith("safe_outputs-")){const toolName=tool.replace(/^safeoutputs-|^safe_outputs-/,"");categories["Safe Outputs"].push(toolName)}else if(tool.startsWith("safeinputs-")||tool.startsWith("safe_inputs-")){const toolName=tool.replace(/^safeinputs-|^safe_inputs-/,"");categories["Safe Inputs"].push(toolName)}else tool.startsWith("mcp__github__")?categories["Git/GitHub"].push(formatMcpName(tool)):tool.startsWith("mcp__playwright__")?categories.Playwright.push(formatMcpName(tool)):tool.startsWith("mcp__serena__")?categories.Serena.push(formatMcpName(tool)):tool.startsWith("mcp__")||["ListMcpResourcesTool","ReadMcpResourceTool"].includes(tool)?categories.MCP.push(tool.startsWith("mcp__")?formatMcpName(tool):tool):isLikelyCustomAgent(tool)?categories["Custom Agents"].push(tool):categories.Other.push(tool)}for(const[category,tools]of Object.entries(categories))tools.length>0&&(markdown+=`- **${category}:** ${tools.length} tools\n`,markdown+=`  - ${tools.join(", ")}\n`);markdown+="\n"}if(includeSlashCommands&&initEntry.slash_commands&&Array.isArray(initEntry.slash_commands)){const commandCount=initEntry.slash_commands.length;markdown+=`**Slash Commands:** ${commandCount} available\n`,markdown+=commandCount<=10?`- ${initEntry.slash_commands.join(", ")}\n`:`- ${initEntry.slash_commands.slice(0,5).join(", ")}, and ${commandCount-5} more\n`,markdown+="\n"}return mcpFailures.length>0?{markdown,mcpFailures}:{markdown}}function formatToolUse(toolUse,toolResult,options={}){const{includeDetailedParameters=!1}=options,toolName=toolUse.name,input=toolUse.input||{};if("TodoWrite"===toolName)return"";const statusIcon=toolResult?!0===toolResult.is_error?"âŒ":"âœ…":"â“";let summary="",details="";toolResult&&toolResult.content&&("string"==typeof toolResult.content?details=toolResult.content:Array.isArray(toolResult.content)&&(details=toolResult.content.map(c=>"string"==typeof c?c:c.text||"").join("\n")));const outputText=details,totalTokens=estimateTokens(JSON.stringify(input))+estimateTokens(outputText);let metadata="";switch(toolResult&&toolResult.duration_ms&&(metadata+=`<code>${formatDuration(toolResult.duration_ms)}</code> `),totalTokens>0&&(metadata+=`<code>~${totalTokens}t</code>`),metadata=metadata.trim(),toolName){case"Bash":const command=input.command||"",description=input.description||"",formattedCommand=formatBashCommand(command);summary=description?`${description}: <code>${formattedCommand}</code>`:`<code>${formattedCommand}</code>`;break;case"Read":summary=`Read <code>${(input.file_path||input.path||"").replace(/^\/[^\/]*\/[^\/]*\/[^\/]*\/[^\/]*\//,"")}</code>`;break;case"Write":case"Edit":case"MultiEdit":summary=`Write <code>${(input.file_path||input.path||"").replace(/^\/[^\/]*\/[^\/]*\/[^\/]*\/[^\/]*\//,"")}</code>`;break;case"Grep":case"Glob":summary=`Search for <code>${truncateString(input.query||input.pattern||"",80)}</code>`;break;case"LS":const lsPath=input.path||"";summary=`LS: ${lsPath.replace(/^\/[^\/]*\/[^\/]*\/[^\/]*\/[^\/]*\//,"")||lsPath}`;break;default:if(toolName.startsWith("mcp__"))summary=`${formatMcpName(toolName)}(${formatMcpParameters(input)})`;else{const keys=Object.keys(input);if(keys.length>0){const mainParam=keys.find(k=>["query","command","path","file_path","content"].includes(k))||keys[0],value=String(input[mainParam]||"");summary=value?`${toolName}: ${truncateString(value,100)}`:toolName}else summary=toolName}}const sections=[];return includeDetailedParameters&&Object.keys(input).length>0&&sections.push({label:"Parameters",content:JSON.stringify(input,null,2),language:"json"}),details&&details.trim()&&sections.push({label:includeDetailedParameters?"Response":"Output",content:details}),formatToolCallAsDetails({summary,statusIcon,sections,metadata:metadata||void 0})}function parseLogEntries(logContent){let logEntries;try{if(logEntries=JSON.parse(logContent),!Array.isArray(logEntries)||0===logEntries.length)throw new Error("Not a JSON array or empty array");return logEntries}catch(jsonArrayError){logEntries=[];const lines=logContent.split("\n");for(const line of lines){const trimmedLine=line.trim();if(""!==trimmedLine){if(trimmedLine.startsWith("[{"))try{const arrayEntries=JSON.parse(trimmedLine);if(Array.isArray(arrayEntries)){logEntries.push(...arrayEntries);continue}}catch(arrayParseError){continue}if(trimmedLine.startsWith("{"))try{const jsonEntry=JSON.parse(trimmedLine);logEntries.push(jsonEntry)}catch(jsonLineError){continue}}}}return Array.isArray(logEntries)&&0!==logEntries.length?logEntries:null}function formatToolCallAsDetails(options){const{summary,statusIcon,sections,metadata,maxContentLength=MAX_TOOL_OUTPUT_LENGTH}=options;let fullSummary=summary;if(statusIcon&&!summary.startsWith(statusIcon)&&(fullSummary=`${statusIcon} ${summary}`),metadata&&(fullSummary+=` ${metadata}`),!sections||!sections.some(s=>s.content&&s.content.trim()))return`${fullSummary}\n\n`;let detailsContent="";for(const section of sections){if(!section.content||!section.content.trim())continue;detailsContent+=`**${section.label}:**\n\n`;let content=section.content;content.length>maxContentLength&&(content=content.substring(0,maxContentLength)+"... (truncated)"),section.language?detailsContent+=`\`\`\`\`\`\`${section.language}\n`:detailsContent+="``````\n",detailsContent+=content,detailsContent+="\n``````\n\n"}return detailsContent=detailsContent.trimEnd(),`<details>\n<summary>${fullSummary}</summary>\n\n${detailsContent}\n</details>\n\n`}function generatePlainTextSummary(logEntries,options={}){const{model,parserName="Agent"}=options,lines=[];lines.push(`=== ${parserName} Execution Summary ===`),model&&lines.push(`Model: ${model}`),lines.push("");const toolUsePairs=new Map;for(const entry of logEntries)if("user"===entry.type&&entry.message?.content)for(const content of entry.message.content)"tool_result"===content.type&&content.tool_use_id&&toolUsePairs.set(content.tool_use_id,content);lines.push("Conversation:"),lines.push("");let conversationLineCount=0,conversationTruncated=!1;for(const entry of logEntries){if(conversationLineCount>=5e3){conversationTruncated=!0;break}if("assistant"===entry.type&&entry.message?.content)for(const content of entry.message.content){if(conversationLineCount>=5e3){conversationTruncated=!0;break}if("text"===content.type&&content.text){const text=content.text.trim();if(text&&text.length>0){const maxTextLength=500;let displayText=text;displayText.length>maxTextLength&&(displayText=displayText.substring(0,maxTextLength)+"...");const textLines=displayText.split("\n");for(const line of textLines){if(conversationLineCount>=5e3){conversationTruncated=!0;break}lines.push(`Agent: ${line}`),conversationLineCount++}lines.push(""),conversationLineCount++}}else if("tool_use"===content.type){const toolName=content.name,input=content.input||{};if(["Read","Write","Edit","MultiEdit","LS","Grep","Glob","TodoWrite"].includes(toolName))continue;const toolResult=toolUsePairs.get(content.id),statusIcon=!0===toolResult?.is_error?"âœ—":"âœ“";let displayName,resultPreview="";if("Bash"===toolName){if(displayName=`$ ${formatBashCommand(input.command||"")}`,toolResult&&toolResult.content){const resultLines=("string"==typeof toolResult.content?toolResult.content:String(toolResult.content)).split("\n").filter(l=>l.trim());if(resultLines.length>0){const previewLine=resultLines[0].substring(0,80);resultLines.length>1?resultPreview=`   â”” ${resultLines.length} lines...`:previewLine&&(resultPreview=`   â”” ${previewLine}`)}}}else if(toolName.startsWith("mcp__")){if(displayName=formatMcpName(toolName).replace("::","-"),toolResult&&toolResult.content){const resultText="string"==typeof toolResult.content?toolResult.content:JSON.stringify(toolResult.content);resultPreview=`   â”” ${resultText.length>80?resultText.substring(0,80)+"...":resultText}`}}else if(displayName=toolName,toolResult&&toolResult.content){const resultText="string"==typeof toolResult.content?toolResult.content:String(toolResult.content);resultPreview=`   â”” ${resultText.length>80?resultText.substring(0,80)+"...":resultText}`}lines.push(`${statusIcon} ${displayName}`),conversationLineCount++,resultPreview&&(lines.push(resultPreview),conversationLineCount++),lines.push(""),conversationLineCount++}}}conversationTruncated&&(lines.push("... (conversation truncated)"),lines.push(""));const lastEntry=logEntries[logEntries.length-1];if(lines.push("Statistics:"),lastEntry?.num_turns&&lines.push(`  Turns: ${lastEntry.num_turns}`),lastEntry?.duration_ms){const duration=formatDuration(lastEntry.duration_ms);duration&&lines.push(`  Duration: ${duration}`)}let toolCounts={total:0,success:0,error:0};for(const entry of logEntries)if("assistant"===entry.type&&entry.message?.content)for(const content of entry.message.content)if("tool_use"===content.type){const toolName=content.name;if(["Read","Write","Edit","MultiEdit","LS","Grep","Glob","TodoWrite"].includes(toolName))continue;toolCounts.total++;const toolResult=toolUsePairs.get(content.id);!0===toolResult?.is_error?toolCounts.error++:toolCounts.success++}if(toolCounts.total>0&&lines.push(`  Tools: ${toolCounts.success}/${toolCounts.total} succeeded`),lastEntry?.usage){const usage=lastEntry.usage;if(usage.input_tokens||usage.output_tokens){const totalTokens=(usage.input_tokens||0)+(usage.output_tokens||0)+(usage.cache_creation_input_tokens||0)+(usage.cache_read_input_tokens||0);lines.push(`  Tokens: ${totalTokens.toLocaleString()} total (${usage.input_tokens.toLocaleString()} in / ${usage.output_tokens.toLocaleString()} out)`)}}return lastEntry?.total_cost_usd&&lines.push(`  Cost: $${lastEntry.total_cost_usd.toFixed(4)}`),lines.join("\n")}function generateCopilotCliStyleSummary(logEntries,options={}){const{model,parserName="Agent"}=options,lines=[],toolUsePairs=new Map;for(const entry of logEntries)if("user"===entry.type&&entry.message?.content)for(const content of entry.message.content)"tool_result"===content.type&&content.tool_use_id&&toolUsePairs.set(content.tool_use_id,content);lines.push("```"),lines.push("Conversation:"),lines.push("");let conversationLineCount=0,conversationTruncated=!1;for(const entry of logEntries){if(conversationLineCount>=5e3){conversationTruncated=!0;break}if("assistant"===entry.type&&entry.message?.content)for(const content of entry.message.content){if(conversationLineCount>=5e3){conversationTruncated=!0;break}if("text"===content.type&&content.text){const text=content.text.trim();if(text&&text.length>0){const maxTextLength=500;let displayText=text;displayText.length>maxTextLength&&(displayText=displayText.substring(0,maxTextLength)+"...");const textLines=displayText.split("\n");for(const line of textLines){if(conversationLineCount>=5e3){conversationTruncated=!0;break}lines.push(`Agent: ${line}`),conversationLineCount++}lines.push(""),conversationLineCount++}}else if("tool_use"===content.type){const toolName=content.name,input=content.input||{};if(["Read","Write","Edit","MultiEdit","LS","Grep","Glob","TodoWrite"].includes(toolName))continue;const toolResult=toolUsePairs.get(content.id),statusIcon=!0===toolResult?.is_error?"âœ—":"âœ“";let displayName,resultPreview="";if("Bash"===toolName){if(displayName=`$ ${formatBashCommand(input.command||"")}`,toolResult&&toolResult.content){const resultLines=("string"==typeof toolResult.content?toolResult.content:String(toolResult.content)).split("\n").filter(l=>l.trim());if(resultLines.length>0){const previewLine=resultLines[0].substring(0,80);resultLines.length>1?resultPreview=`   â”” ${resultLines.length} lines...`:previewLine&&(resultPreview=`   â”” ${previewLine}`)}}}else if(toolName.startsWith("mcp__")){if(displayName=formatMcpName(toolName).replace("::","-"),toolResult&&toolResult.content){const resultText="string"==typeof toolResult.content?toolResult.content:JSON.stringify(toolResult.content);resultPreview=`   â”” ${resultText.length>80?resultText.substring(0,80)+"...":resultText}`}}else if(displayName=toolName,toolResult&&toolResult.content){const resultText="string"==typeof toolResult.content?toolResult.content:String(toolResult.content);resultPreview=`   â”” ${resultText.length>80?resultText.substring(0,80)+"...":resultText}`}lines.push(`${statusIcon} ${displayName}`),conversationLineCount++,resultPreview&&(lines.push(resultPreview),conversationLineCount++),lines.push(""),conversationLineCount++}}}conversationTruncated&&(lines.push("... (conversation truncated)"),lines.push(""));const lastEntry=logEntries[logEntries.length-1];if(lines.push("Statistics:"),lastEntry?.num_turns&&lines.push(`  Turns: ${lastEntry.num_turns}`),lastEntry?.duration_ms){const duration=formatDuration(lastEntry.duration_ms);duration&&lines.push(`  Duration: ${duration}`)}let toolCounts={total:0,success:0,error:0};for(const entry of logEntries)if("assistant"===entry.type&&entry.message?.content)for(const content of entry.message.content)if("tool_use"===content.type){const toolName=content.name;if(["Read","Write","Edit","MultiEdit","LS","Grep","Glob","TodoWrite"].includes(toolName))continue;toolCounts.total++;const toolResult=toolUsePairs.get(content.id);!0===toolResult?.is_error?toolCounts.error++:toolCounts.success++}if(toolCounts.total>0&&lines.push(`  Tools: ${toolCounts.success}/${toolCounts.total} succeeded`),lastEntry?.usage){const usage=lastEntry.usage;if(usage.input_tokens||usage.output_tokens){const totalTokens=(usage.input_tokens||0)+(usage.output_tokens||0)+(usage.cache_creation_input_tokens||0)+(usage.cache_read_input_tokens||0);lines.push(`  Tokens: ${totalTokens.toLocaleString()} total (${usage.input_tokens.toLocaleString()} in / ${usage.output_tokens.toLocaleString()} out)`)}}return lastEntry?.total_cost_usd&&lines.push(`  Cost: $${lastEntry.total_cost_usd.toFixed(4)}`),lines.push("```"),lines.join("\n")}module.exports={MAX_TOOL_OUTPUT_LENGTH,MAX_STEP_SUMMARY_SIZE:1024e3,StepSummaryTracker,formatDuration,formatBashCommand,truncateString,estimateTokens,formatMcpName,isLikelyCustomAgent,generateConversationMarkdown,generateInformationSection,formatMcpParameters,formatInitializationSummary,formatToolUse,parseLogEntries,formatToolCallAsDetails,generatePlainTextSummary,generateCopilotCliStyleSummary};
import{describe,it,expect,beforeEach,afterEach,vi}from"vitest";describe("getCurrentBranch",()=>{let originalEnv;beforeEach(()=>{originalEnv={GITHUB_HEAD_REF:process.env.GITHUB_HEAD_REF,GITHUB_REF_NAME:process.env.GITHUB_REF_NAME,GITHUB_WORKSPACE:process.env.GITHUB_WORKSPACE},delete process.env.GITHUB_HEAD_REF,delete process.env.GITHUB_REF_NAME,delete process.env.GITHUB_WORKSPACE}),afterEach(()=>{void 0!==originalEnv.GITHUB_HEAD_REF&&(process.env.GITHUB_HEAD_REF=originalEnv.GITHUB_HEAD_REF),void 0!==originalEnv.GITHUB_REF_NAME&&(process.env.GITHUB_REF_NAME=originalEnv.GITHUB_REF_NAME),void 0!==originalEnv.GITHUB_WORKSPACE&&(process.env.GITHUB_WORKSPACE=originalEnv.GITHUB_WORKSPACE)}),it("should return GITHUB_HEAD_REF if set",async()=>{process.env.GITHUB_HEAD_REF="feature/test-branch",process.env.GITHUB_REF_NAME="other-branch";const{getCurrentBranch}=await import("./get_current_branch.cjs");try{const result=getCurrentBranch();expect(typeof result).toBe("string"),expect(result.length).toBeGreaterThan(0)}catch(error){expect(error.message).toContain("Failed to determine current branch")}}),it("should return GITHUB_REF_NAME if GITHUB_HEAD_REF not set",async()=>{delete process.env.GITHUB_HEAD_REF,process.env.GITHUB_REF_NAME="main";const{getCurrentBranch}=await import("./get_current_branch.cjs");try{const result=getCurrentBranch();expect(typeof result).toBe("string"),expect(result.length).toBeGreaterThan(0)}catch(error){expect(error.message).toContain("Failed to determine current branch")}}),it("should throw error when no branch can be determined",async()=>{delete process.env.GITHUB_HEAD_REF,delete process.env.GITHUB_REF_NAME,process.env.GITHUB_WORKSPACE="/tmp/nonexistent-git-repo";const{getCurrentBranch}=await import("./get_current_branch.cjs");expect(()=>getCurrentBranch()).toThrow("Failed to determine current branch")}),it("should prioritize GITHUB_HEAD_REF over GITHUB_REF_NAME",async()=>{process.env.GITHUB_HEAD_REF="pr-branch",process.env.GITHUB_REF_NAME="main",process.env.GITHUB_WORKSPACE="/tmp/nonexistent-git-repo";const{getCurrentBranch}=await import("./get_current_branch.cjs");try{const result=getCurrentBranch();"pr-branch"!==result&&"main"!==result||expect(result).toBeTruthy()}catch(error){expect(error.message).toContain("Failed to determine current branch")}})});
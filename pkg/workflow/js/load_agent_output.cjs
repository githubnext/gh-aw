const fs=require("fs"),MAX_LOG_CONTENT_LENGTH=1e4;function truncateForLogging(content){return content.length<=1e4?content:content.substring(0,1e4)+`\n... (truncated, total length: ${content.length})`}function loadAgentOutput(){const agentOutputFile=process.env.GH_AW_AGENT_OUTPUT;if(!agentOutputFile)return core.info("No GH_AW_AGENT_OUTPUT environment variable found"),{success:!1};let outputContent,validatedOutput;try{outputContent=fs.readFileSync(agentOutputFile,"utf8")}catch(error){const errorMessage=`Error reading agent output file: ${error instanceof Error?error.message:String(error)}`;return core.error(errorMessage),{success:!1,error:errorMessage}}if(""===outputContent.trim())return core.info("Agent output content is empty"),{success:!1};core.info(`Agent output content length: ${outputContent.length}`);try{validatedOutput=JSON.parse(outputContent)}catch(error){const errorMessage=`Error parsing agent output JSON: ${error instanceof Error?error.message:String(error)}`;return core.error(errorMessage),core.info(`Failed to parse content:\n${truncateForLogging(outputContent)}`),{success:!1,error:errorMessage}}return validatedOutput.items&&Array.isArray(validatedOutput.items)?{success:!0,items:validatedOutput.items}:(core.info("No valid items found in agent output"),core.info(`Parsed content: ${truncateForLogging(JSON.stringify(validatedOutput))}`),{success:!1})}module.exports={loadAgentOutput,truncateForLogging,MAX_LOG_CONTENT_LENGTH:1e4};
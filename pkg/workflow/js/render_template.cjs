const fs=require("fs");function isTruthy(expr){const v=expr.trim().toLowerCase();return!(""===v||"false"===v||"0"===v||"null"===v||"undefined"===v)}function renderMarkdownTemplate(markdown){let result=markdown.replace(/(\n?)([ \t]*{{#if\s+(.*?)\s*}}[ \t]*\n)([\s\S]*?)([ \t]*{{\/if}}[ \t]*)(\n?)/g,(match,leadNL,openLine,cond,body,closeLine,trailNL)=>isTruthy(cond)?leadNL+body:"");return result=result.replace(/{{#if\s+(.*?)\s*}}([\s\S]*?){{\/if}}/g,(_,cond,body)=>isTruthy(cond)?body:""),result=result.replace(/\n{3,}/g,"\n\n"),result}function main(){try{const promptPath=process.env.GH_AW_PROMPT;promptPath||(core.setFailed("GH_AW_PROMPT environment variable is not set"),process.exit(1));const markdown=fs.readFileSync(promptPath,"utf8");/{{#if\s+[^}]+}}/.test(markdown)||(core.info("No conditional blocks found in prompt, skipping template rendering"),process.exit(0));const rendered=renderMarkdownTemplate(markdown);fs.writeFileSync(promptPath,rendered,"utf8"),core.info("Template rendered successfully")}catch(error){core.setFailed(error instanceof Error?error.message:String(error))}}main();
class ReadBuffer{constructor(){this._buffer=null}append(chunk){this._buffer=this._buffer?Buffer.concat([this._buffer,chunk]):chunk}readMessage(){if(!this._buffer)return null;const index=this._buffer.indexOf("\n");if(-1===index)return null;const line=this._buffer.toString("utf8",0,index).replace(/\r$/,"");if(this._buffer=this._buffer.subarray(index+1),""===line.trim())return this.readMessage();try{return JSON.parse(line)}catch(error){throw new Error(`Parse error: ${error instanceof Error?error.message:String(error)}`)}}}module.exports={ReadBuffer};
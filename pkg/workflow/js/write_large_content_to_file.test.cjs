import{describe,it,expect,beforeEach,afterEach}from"vitest";import fs from"fs";import path from"path";describe("writeLargeContentToFile",()=>{const testDir="/tmp/gh-aw/safeoutputs";beforeEach(()=>{fs.existsSync(testDir)&&fs.rmSync(testDir,{recursive:!0})}),afterEach(()=>{fs.existsSync(testDir)&&fs.rmSync(testDir,{recursive:!0})}),it("should create directory if it doesn't exist",async()=>{const{writeLargeContentToFile}=await import("./write_large_content_to_file.cjs");expect(fs.existsSync(testDir)).toBe(!1);writeLargeContentToFile(JSON.stringify({test:"data"})),expect(fs.existsSync(testDir)).toBe(!0)}),it("should write content to file with hash-based filename",async()=>{const{writeLargeContentToFile}=await import("./write_large_content_to_file.cjs"),content=JSON.stringify({test:"data"}),result=writeLargeContentToFile(content);expect(result).toHaveProperty("filename"),expect(result.filename).toMatch(/^[a-f0-9]{64}\.json$/);const filepath=path.join(testDir,result.filename);expect(fs.existsSync(filepath)).toBe(!0);const written=fs.readFileSync(filepath,"utf8");expect(written).toBe(content)}),it("should return schema description",async()=>{const{writeLargeContentToFile}=await import("./write_large_content_to_file.cjs"),result=writeLargeContentToFile(JSON.stringify({id:1,name:"test",value:10}));expect(result).toHaveProperty("description"),expect(result.description).toBe("{id, name, value}")}),it("should use .json extension",async()=>{const{writeLargeContentToFile}=await import("./write_large_content_to_file.cjs"),result=writeLargeContentToFile(JSON.stringify([1,2,3]));expect(result.filename).toMatch(/\.json$/)}),it("should generate consistent hash for same content",async()=>{const{writeLargeContentToFile}=await import("./write_large_content_to_file.cjs"),content=JSON.stringify({test:"data"}),result1=writeLargeContentToFile(content),result2=writeLargeContentToFile(content);expect(result1.filename).toBe(result2.filename)}),it("should generate different hash for different content",async()=>{const{writeLargeContentToFile}=await import("./write_large_content_to_file.cjs"),content1=JSON.stringify({test:"data1"}),content2=JSON.stringify({test:"data2"}),result1=writeLargeContentToFile(content1),result2=writeLargeContentToFile(content2);expect(result1.filename).not.toBe(result2.filename)}),it("should handle arrays",async()=>{const{writeLargeContentToFile}=await import("./write_large_content_to_file.cjs"),result=writeLargeContentToFile(JSON.stringify([{id:1},{id:2}]));expect(result.description).toBe("[{id}] (2 items)")}),it("should handle large content",async()=>{const{writeLargeContentToFile}=await import("./write_large_content_to_file.cjs"),largeObj={};for(let i=0;i<1e3;i++)largeObj[`key${i}`]=`value${i}`;const content=JSON.stringify(largeObj),result=writeLargeContentToFile(content);expect(result).toHaveProperty("filename"),expect(result).toHaveProperty("description");const filepath=path.join(testDir,result.filename),written=fs.readFileSync(filepath,"utf8");expect(written).toBe(content)})});
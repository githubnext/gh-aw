const fs=require("fs"),path=require("path");function hasFrontMatter(content){return content.trimStart().startsWith("---\n")||content.trimStart().startsWith("---\r\n")}function removeXMLComments(content){return content.replace(/<!--[\s\S]*?-->/g,"")}function hasGitHubActionsMacros(content){return/\$\{\{[\s\S]*?\}\}/.test(content)}function processRuntimeImport(filepath,optional,workspaceDir){const absolutePath=path.resolve(workspaceDir,filepath);if(!fs.existsSync(absolutePath)){if(optional)return core.warning(`Optional runtime import file not found: ${filepath}`),"";throw new Error(`Runtime import file not found: ${filepath}`)}let content=fs.readFileSync(absolutePath,"utf8");if(hasFrontMatter(content)){core.warning(`File ${filepath} contains front matter which will be ignored in runtime import`);const lines=content.split("\n");let inFrontMatter=!1,frontMatterCount=0;const processedLines=[];for(const line of lines){if("---"===line.trim()||"---\r"===line.trim()){if(frontMatterCount++,1===frontMatterCount){inFrontMatter=!0;continue}if(2===frontMatterCount){inFrontMatter=!1;continue}}!inFrontMatter&&frontMatterCount>=2&&processedLines.push(line)}content=processedLines.join("\n")}if(content=removeXMLComments(content),hasGitHubActionsMacros(content))throw new Error(`File ${filepath} contains GitHub Actions macros (\${{ ... }}) which are not allowed in runtime imports`);return content}function processRuntimeImports(content,workspaceDir){const pattern=/\{\{#runtime-import(\?)?[ \t]+([^\}]+?)\}\}/g;let match,processedContent=content;const importedFiles=new Set;for(pattern.lastIndex=0;null!==(match=pattern.exec(content));){const optional="?"===match[1],filepath=match[2].trim(),fullMatch=match[0];importedFiles.has(filepath)&&core.warning(`File ${filepath} is imported multiple times, which may indicate a circular reference`),importedFiles.add(filepath);try{const importedContent=processRuntimeImport(filepath,optional,workspaceDir);processedContent=processedContent.replace(fullMatch,importedContent)}catch(error){throw new Error(`Failed to process runtime import for ${filepath}: ${error.message}`)}}return processedContent}module.exports={processRuntimeImports,processRuntimeImport,hasFrontMatter,removeXMLComments,hasGitHubActionsMacros};
const fs=require("fs");function loadTools(server){const toolsPath=process.env.GH_AW_SAFE_OUTPUTS_TOOLS_PATH||"/tmp/gh-aw/safeoutputs/tools.json";let ALL_TOOLS=[];server.debug(`Reading tools from file: ${toolsPath}`);try{if(fs.existsSync(toolsPath)){server.debug(`Tools file exists at: ${toolsPath}`);const toolsFileContent=fs.readFileSync(toolsPath,"utf8");server.debug(`Tools file content length: ${toolsFileContent.length} characters`),server.debug("Tools file read successfully, attempting to parse JSON"),ALL_TOOLS=JSON.parse(toolsFileContent),server.debug(`Successfully parsed ${ALL_TOOLS.length} tools from file`)}else server.debug(`Tools file does not exist at: ${toolsPath}`),server.debug("Using empty tools array"),ALL_TOOLS=[]}catch(error){server.debug(`Error reading tools file: ${error instanceof Error?error.message:String(error)}`),server.debug("Falling back to empty tools array"),ALL_TOOLS=[]}return ALL_TOOLS}function attachHandlers(tools,handlers){return tools.forEach(tool=>{"create_pull_request"===tool.name?tool.handler=handlers.createPullRequestHandler:"push_to_pull_request_branch"===tool.name?tool.handler=handlers.pushToPullRequestBranchHandler:"upload_asset"===tool.name&&(tool.handler=handlers.uploadAssetHandler)}),tools}function registerPredefinedTools(server,tools,config,registerTool,normalizeTool){tools.forEach(tool=>{Object.keys(config).find(configKey=>normalizeTool(configKey)===tool.name)&&registerTool(server,tool)})}function registerDynamicTools(server,tools,config,outputFile,registerTool,normalizeTool){Object.keys(config).forEach(configKey=>{const normalizedKey=normalizeTool(configKey);if(!server.tools[normalizedKey]&&!tools.find(t=>t.name===normalizedKey)){const jobConfig=config[configKey],dynamicTool={name:normalizedKey,description:jobConfig&&jobConfig.description?jobConfig.description:`Custom safe-job: ${configKey}`,inputSchema:{type:"object",properties:{},additionalProperties:!0},handler:args=>{const entry={type:normalizedKey,...args},entryJSON=JSON.stringify(entry);fs.appendFileSync(outputFile,entryJSON+"\n");const outputText=jobConfig&&jobConfig.output?jobConfig.output:`Safe-job '${configKey}' executed successfully with arguments: ${JSON.stringify(args)}`;return{content:[{type:"text",text:JSON.stringify({result:outputText})}]}}};jobConfig&&jobConfig.inputs&&(dynamicTool.inputSchema.properties={},dynamicTool.inputSchema.required=[],Object.keys(jobConfig.inputs).forEach(inputName=>{const inputDef=jobConfig.inputs[inputName],propSchema={type:inputDef.type||"string",description:inputDef.description||`Input parameter: ${inputName}`};inputDef.options&&Array.isArray(inputDef.options)&&(propSchema.enum=inputDef.options),dynamicTool.inputSchema.properties[inputName]=propSchema,inputDef.required&&dynamicTool.inputSchema.required.push(inputName)})),registerTool(server,dynamicTool)}})}module.exports={loadTools,attachHandlers,registerPredefinedTools,registerDynamicTools};
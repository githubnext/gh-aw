const{createServer,registerTool,start}=require("./mcp_server_core.cjs"),{loadConfig}=require("./safe_inputs_config_loader.cjs"),{createToolConfig}=require("./safe_inputs_tool_factory.cjs"),{bootstrapSafeInputsServer,cleanupConfigFile}=require("./safe_inputs_bootstrap.cjs");function startSafeInputsServer(configPath,options={}){const logDir=options.logDir||void 0,server=createServer({name:"safeinputs",version:"1.0.0"},{logDir}),{config,tools}=bootstrapSafeInputsServer(configPath,server);server.serverInfo.name=config.serverName||"safeinputs",server.serverInfo.version=config.version||"1.0.0",!options.logDir&&config.logDir&&(server.logDir=config.logDir);for(const tool of tools)registerTool(server,tool);options.skipCleanup||cleanupConfigFile(configPath,server),start(server)}if(require.main===module){const args=process.argv.slice(2);args.length<1&&(console.error("Usage: node safe_inputs_mcp_server.cjs <config.json> [--log-dir <path>]"),process.exit(1));const configPath=args[0],options={};for(let i=1;i<args.length;i++)"--log-dir"===args[i]&&args[i+1]&&(options.logDir=args[i+1],i++);try{startSafeInputsServer(configPath,options)}catch(error){console.error(`Error starting safe-inputs server: ${error instanceof Error?error.message:String(error)}`),process.exit(1)}}module.exports={startSafeInputsServer,loadConfig,createToolConfig};
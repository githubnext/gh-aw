{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://github.com/githubnext/gh-aw/schemas/included_file_schema.json",
  "title": "Included File Schema",
  "description": "JSON Schema for validating included workflow file frontmatter",
  "version": "1.0.0",
  "type": "object",
  "properties": {
    "description": {
      "type": "string",
      "description": "Optional description for the included file or custom agent configuration. Used for documentation and clarity.",
      "examples": ["Agent instructions", "Shared tool configuration", "Common workflow steps"]
    },
    "metadata": {
      "type": "object",
      "description": "Optional metadata field for storing custom key-value pairs compatible with the custom agent spec. Key names are limited to 64 characters, and values are limited to 1024 characters.",
      "patternProperties": {
        "^.{1,64}$": {
          "type": "string",
          "maxLength": 1024,
          "description": "Metadata value (maximum 1024 characters)"
        }
      },
      "additionalProperties": false,
      "examples": [
        {
          "author": "Jane Smith",
          "version": "2.0.0",
          "category": "tools"
        }
      ]
    },
    "inputs": {
      "type": "object",
      "description": "Input parameters for the shared workflow. Uses the same schema as workflow_dispatch inputs. Values can be referenced in the workflow using ${{ github.aw.inputs.<key> }} expressions.",
      "maxProperties": 25,
      "additionalProperties": {
        "type": "object",
        "additionalProperties": false,
        "properties": {
          "description": {
            "type": "string",
            "description": "Input description"
          },
          "required": {
            "type": "boolean",
            "description": "Whether input is required"
          },
          "default": {
            "oneOf": [
              {
                "type": "string"
              },
              {
                "type": "number"
              },
              {
                "type": "boolean"
              }
            ],
            "description": "Default value for the input"
          },
          "type": {
            "type": "string",
            "enum": ["string", "choice", "boolean", "number"],
            "description": "Input type"
          },
          "options": {
            "type": "array",
            "description": "Options for choice type",
            "items": {
              "type": "string"
            }
          }
        }
      },
      "examples": [
        {
          "count": {
            "description": "Number of items to fetch",
            "type": "number",
            "default": 100
          }
        }
      ]
    },
    "applyTo": {
      "description": "Glob pattern(s) specifying which files/directories these instructions should apply to. Used in custom agent instruction files to target specific code areas. Supports wildcards (e.g., '**/*' for all files, '**/*.py' for Python files). Can be a single pattern string or array of patterns. If omitted in custom agent files, instructions apply globally.",
      "oneOf": [
        {
          "type": "string",
          "description": "Single glob pattern for files/directories where these instructions apply (for custom agent instruction files)",
          "examples": ["**/*.py", "src/**/*.js", "pkg/workflow/*.go"]
        },
        {
          "type": "array",
          "description": "Multiple glob patterns for files/directories where these instructions apply (for custom agent instruction files)",
          "items": {
            "type": "string",
            "description": "Glob pattern for file/directory matching"
          },
          "examples": [
            ["**/*.py", "**/*.pyw"],
            ["src/**/*.ts", "src/**/*.tsx"]
          ]
        }
      ]
    },
    "services": {
      "type": "object",
      "description": "Service containers to be merged with main workflow services",
      "additionalProperties": true
    },
    "mcp-servers": {
      "type": "object",
      "description": "MCP server definitions that can be imported into workflows",
      "patternProperties": {
        "^[a-zA-Z0-9_-]+$": {
          "oneOf": [
            {
              "$ref": "#/$defs/stdio_mcp_tool"
            },
            {
              "$ref": "#/$defs/http_mcp_tool"
            }
          ]
        }
      },
      "additionalProperties": false
    },
    "steps": {
      "description": "Custom workflow steps to be merged with main workflow",
      "oneOf": [
        {
          "type": "object",
          "additionalProperties": true
        },
        {
          "type": "array",
          "items": {
            "oneOf": [
              {
                "type": "string"
              },
              {
                "type": "object",
                "additionalProperties": true
              }
            ]
          }
        }
      ]
    },
    "tools": {
      "type": "object",
      "description": "Tools configuration for the included file",
      "properties": {
        "bash": {
          "description": "Bash shell command execution tool for running command-line programs and scripts",
          "oneOf": [
            {
              "type": "null",
              "description": "Enable bash tool with all shell commands allowed"
            },
            {
              "type": "boolean",
              "description": "Enable bash tool - true allows all commands (equivalent to ['*']), false disables the tool"
            },
            {
              "type": "array",
              "description": "List of allowed bash commands and patterns (e.g., ['ast-grep:*', 'sg:*'])",
              "items": {
                "type": "string"
              }
            }
          ]
        },
        "cache-memory": {
          "description": "Cache memory MCP configuration for persistent memory storage",
          "oneOf": [
            {
              "type": "boolean",
              "description": "Enable cache-memory with default settings"
            },
            {
              "type": "null",
              "description": "Enable cache-memory with default settings (same as true)"
            },
            {
              "type": "object",
              "description": "Cache-memory configuration object",
              "properties": {
                "key": {
                  "type": "string",
                  "description": "Custom cache key for memory MCP data (restore keys are auto-generated by splitting on '-')"
                },
                "description": {
                  "type": "string",
                  "description": "Optional description for the cache that will be shown in the agent prompt"
                },
                "retention-days": {
                  "type": "integer",
                  "minimum": 1,
                  "maximum": 90,
                  "description": "Number of days to retain uploaded artifacts (1-90 days, default: repository setting)"
                },
                "restore-only": {
                  "type": "boolean",
                  "description": "If true, only restore the cache without saving it back. Uses actions/cache/restore instead of actions/cache. No artifact upload step will be generated."
                }
              },
              "additionalProperties": false
            },
            {
              "type": "array",
              "description": "Array of cache-memory configurations for multiple caches",
              "items": {
                "type": "object",
                "properties": {
                  "id": {
                    "type": "string",
                    "description": "Cache identifier (required for array notation, default: 'default')"
                  },
                  "key": {
                    "type": "string",
                    "description": "Custom cache key for this memory cache (restore keys are auto-generated by splitting on '-')"
                  },
                  "description": {
                    "type": "string",
                    "description": "Optional description for this cache that will be shown in the agent prompt"
                  },
                  "retention-days": {
                    "type": "integer",
                    "minimum": 1,
                    "maximum": 90,
                    "description": "Number of days to retain uploaded artifacts (1-90 days, default: repository setting)"
                  },
                  "restore-only": {
                    "type": "boolean",
                    "description": "If true, only restore the cache without saving it back. Uses actions/cache/restore instead of actions/cache. No artifact upload step will be generated."
                  }
                },
                "additionalProperties": false
              },
              "minItems": 1
            }
          ]
        },
        "github": {
          "description": "GitHub tools configuration",
          "oneOf": [
            {
              "type": "string",
              "description": "Simple github tool string"
            },
            {
              "type": "object",
              "description": "GitHub tools object configuration",
              "properties": {
                "allowed": {
                  "type": "array",
                  "description": "List of allowed GitHub tools",
                  "items": {
                    "type": "string"
                  }
                }
              },
              "additionalProperties": true
            }
          ]
        },
        "repo-memory": {
          "description": "Repo memory configuration for git-based persistent storage",
          "oneOf": [
            {
              "type": "boolean",
              "description": "Enable repo-memory with default settings"
            },
            {
              "type": "null",
              "description": "Enable repo-memory with default settings (same as true)"
            },
            {
              "type": "object",
              "description": "Repo-memory configuration object",
              "properties": {
                "branch-prefix": {
                  "type": "string",
                  "minLength": 4,
                  "maxLength": 32,
                  "pattern": "^[a-zA-Z0-9_-]+$",
                  "description": "Branch prefix for memory storage (default: 'memory'). Must be 4-32 characters, alphanumeric with hyphens/underscores, and cannot be 'copilot'. Branch will be named {branch-prefix}/{id}"
                },
                "target-repo": {
                  "type": "string",
                  "description": "Target repository for memory storage (default: current repository). Format: owner/repo"
                },
                "branch-name": {
                  "type": "string",
                  "description": "Git branch name for memory storage (default: {branch-prefix}/default or memory/default if branch-prefix not set)"
                },
                "file-glob": {
                  "oneOf": [
                    {
                      "type": "string",
                      "description": "Single file glob pattern for allowed files"
                    },
                    {
                      "type": "array",
                      "description": "Array of file glob patterns for allowed files",
                      "items": {
                        "type": "string"
                      }
                    }
                  ]
                },
                "max-file-size": {
                  "type": "integer",
                  "minimum": 1,
                  "maximum": 104857600,
                  "description": "Maximum size per file in bytes (default: 10240 = 10KB)"
                },
                "max-file-count": {
                  "type": "integer",
                  "minimum": 1,
                  "maximum": 1000,
                  "description": "Maximum file count per commit (default: 100)"
                },
                "description": {
                  "type": "string",
                  "description": "Optional description for the memory that will be shown in the agent prompt"
                },
                "create-orphan": {
                  "type": "boolean",
                  "description": "Create orphaned branch if it doesn't exist (default: true)"
                }
              },
              "additionalProperties": false,
              "examples": [
                {
                  "branch-name": "memory/session-state"
                },
                {
                  "target-repo": "myorg/memory-repo",
                  "branch-name": "memory/agent-notes",
                  "max-file-size": 524288
                }
              ]
            },
            {
              "type": "array",
              "description": "Array of repo-memory configurations for multiple memory locations",
              "items": {
                "type": "object",
                "properties": {
                  "id": {
                    "type": "string",
                    "description": "Memory identifier (required for array notation, default: 'default')"
                  },
                  "branch-prefix": {
                    "type": "string",
                    "minLength": 4,
                    "maxLength": 32,
                    "pattern": "^[a-zA-Z0-9_-]+$",
                    "description": "Branch prefix for memory storage (default: 'memory'). Must be 4-32 characters, alphanumeric with hyphens/underscores, and cannot be 'copilot'. Applied to all entries in the array. Branch will be named {branch-prefix}/{id}"
                  },
                  "target-repo": {
                    "type": "string",
                    "description": "Target repository for memory storage (default: current repository). Format: owner/repo"
                  },
                  "branch-name": {
                    "type": "string",
                    "description": "Git branch name for memory storage (default: {branch-prefix}/{id} or memory/{id} if branch-prefix not set)"
                  },
                  "file-glob": {
                    "oneOf": [
                      {
                        "type": "string",
                        "description": "Single file glob pattern for allowed files"
                      },
                      {
                        "type": "array",
                        "description": "Array of file glob patterns for allowed files",
                        "items": {
                          "type": "string"
                        }
                      }
                    ]
                  },
                  "max-file-size": {
                    "type": "integer",
                    "minimum": 1,
                    "maximum": 104857600,
                    "description": "Maximum size per file in bytes (default: 10240 = 10KB)"
                  },
                  "max-file-count": {
                    "type": "integer",
                    "minimum": 1,
                    "maximum": 1000,
                    "description": "Maximum file count per commit (default: 100)"
                  },
                  "description": {
                    "type": "string",
                    "description": "Optional description for this memory that will be shown in the agent prompt"
                  },
                  "create-orphan": {
                    "type": "boolean",
                    "description": "Create orphaned branch if it doesn't exist (default: true)"
                  }
                },
                "additionalProperties": false
              },
              "minItems": 1,
              "examples": [
                [
                  {
                    "id": "default",
                    "branch-name": "memory/default"
                  },
                  {
                    "id": "session",
                    "branch-name": "memory/session"
                  }
                ]
              ]
            }
          ],
          "examples": [
            true,
            null,
            {
              "branch-name": "memory/agent-state"
            },
            [
              {
                "id": "default",
                "branch-name": "memory/default"
              },
              {
                "id": "logs",
                "branch-name": "memory/logs",
                "max-file-size": 524288
              }
            ]
          ]
        },
        "playwright": {
          "description": "Playwright browser automation tool for web scraping, testing, and UI interactions in containerized browsers",
          "oneOf": [
            {
              "type": "null",
              "description": "Enable Playwright tool with default settings (localhost access only for security)"
            },
            {
              "type": "object",
              "description": "Playwright tool configuration with custom version and domain restrictions",
              "properties": {
                "version": {
                  "type": ["string", "number"],
                  "description": "Optional Playwright container version (e.g., 'v1.41.0', 1.41, 20). Numeric values are automatically converted to strings at runtime.",
                  "examples": ["v1.41.0", 1.41, 20]
                },
                "allowed_domains": {
                  "description": "Domains allowed for Playwright browser network access. Supports wildcard patterns like '*.example.com' (matches sub.example.com and example.com). Defaults to localhost only for security.",
                  "oneOf": [
                    {
                      "type": "array",
                      "description": "List of allowed domains or wildcard patterns (e.g., ['github.com', '*.example.com'])",
                      "items": {
                        "type": "string"
                      }
                    },
                    {
                      "type": "string",
                      "description": "Single allowed domain or wildcard pattern (e.g., 'github.com', '*.cdn.example.com')"
                    }
                  ]
                },
                "args": {
                  "type": "array",
                  "description": "Optional additional arguments to append to the generated MCP server command",
                  "items": {
                    "type": "string"
                  }
                }
              },
              "additionalProperties": false
            }
          ]
        },
        "serena": {
          "description": "Serena MCP server for AI-powered code intelligence with language service integration",
          "oneOf": [
            {
              "type": "null",
              "description": "Enable Serena with default settings"
            },
            {
              "type": "array",
              "description": "Short syntax: array of language identifiers to enable (e.g., [\"go\", \"typescript\"])",
              "items": {
                "type": "string",
                "enum": ["go", "typescript", "python", "java", "rust", "csharp"]
              }
            },
            {
              "type": "object",
              "description": "Serena configuration with custom version and language-specific settings",
              "properties": {
                "version": {
                  "type": ["string", "number"],
                  "description": "Optional Serena MCP version. Numeric values are automatically converted to strings at runtime.",
                  "examples": ["latest", "0.1.0", 1.0]
                },
                "mode": {
                  "type": "string",
                  "description": "Serena execution mode: 'docker' (default, runs in container) or 'local' (runs locally with uvx and HTTP transport)",
                  "enum": ["docker", "local"],
                  "default": "docker"
                },
                "args": {
                  "type": "array",
                  "description": "Optional additional arguments to append to the generated MCP server command",
                  "items": {
                    "type": "string"
                  }
                },
                "languages": {
                  "type": "object",
                  "description": "Language-specific configuration for Serena language services",
                  "properties": {
                    "go": {
                      "oneOf": [
                        {
                          "type": "null",
                          "description": "Enable Go language service with default version"
                        },
                        {
                          "type": "object",
                          "properties": {
                            "version": {
                              "type": ["string", "number"],
                              "description": "Go version (e.g., \"1.21\", 1.21)"
                            },
                            "go-mod-file": {
                              "type": "string",
                              "description": "Path to go.mod file for Go version detection (e.g., \"go.mod\", \"backend/go.mod\")"
                            },
                            "gopls-version": {
                              "type": "string",
                              "description": "Version of gopls to install (e.g., \"latest\", \"v0.14.2\")"
                            }
                          },
                          "additionalProperties": false
                        }
                      ]
                    },
                    "typescript": {
                      "oneOf": [
                        {
                          "type": "null",
                          "description": "Enable TypeScript language service with default version"
                        },
                        {
                          "type": "object",
                          "properties": {
                            "version": {
                              "type": ["string", "number"],
                              "description": "Node.js version for TypeScript (e.g., \"22\", 22)"
                            }
                          },
                          "additionalProperties": false
                        }
                      ]
                    },
                    "python": {
                      "oneOf": [
                        {
                          "type": "null",
                          "description": "Enable Python language service with default version"
                        },
                        {
                          "type": "object",
                          "properties": {
                            "version": {
                              "type": ["string", "number"],
                              "description": "Python version (e.g., \"3.12\", 3.12)"
                            }
                          },
                          "additionalProperties": false
                        }
                      ]
                    },
                    "java": {
                      "oneOf": [
                        {
                          "type": "null",
                          "description": "Enable Java language service with default version"
                        },
                        {
                          "type": "object",
                          "properties": {
                            "version": {
                              "type": ["string", "number"],
                              "description": "Java version (e.g., \"21\", 21)"
                            }
                          },
                          "additionalProperties": false
                        }
                      ]
                    },
                    "rust": {
                      "oneOf": [
                        {
                          "type": "null",
                          "description": "Enable Rust language service with default version"
                        },
                        {
                          "type": "object",
                          "properties": {
                            "version": {
                              "type": ["string", "number"],
                              "description": "Rust version (e.g., \"stable\", \"1.75\")"
                            }
                          },
                          "additionalProperties": false
                        }
                      ]
                    },
                    "csharp": {
                      "oneOf": [
                        {
                          "type": "null",
                          "description": "Enable C# language service with default version"
                        },
                        {
                          "type": "object",
                          "properties": {
                            "version": {
                              "type": ["string", "number"],
                              "description": ".NET version for C# (e.g., \"8.0\", 8.0)"
                            }
                          },
                          "additionalProperties": false
                        }
                      ]
                    }
                  },
                  "additionalProperties": false
                }
              },
              "additionalProperties": false
            }
          ]
        },
        "agentic-workflows": {
          "description": "GitHub Agentic Workflows MCP server for workflow introspection and analysis. Provides tools for checking status, compiling workflows, downloading logs, and auditing runs.",
          "oneOf": [
            {
              "type": "boolean",
              "description": "Enable agentic-workflows tool with default settings"
            },
            {
              "type": "null",
              "description": "Enable agentic-workflows tool with default settings (same as true)"
            }
          ],
          "examples": [true, null]
        },
        "edit": {
          "description": "File editing tool for reading, creating, and modifying files in the repository",
          "oneOf": [
            {
              "type": "null",
              "description": "Enable edit tool"
            },
            {
              "type": "object",
              "description": "Edit tool configuration object",
              "additionalProperties": false
            }
          ]
        },
        "web-fetch": {
          "description": "Web content fetching tool for downloading web pages and API responses (subject to network permissions)",
          "oneOf": [
            {
              "type": "null",
              "description": "Enable web fetch tool with default configuration"
            },
            {
              "type": "object",
              "description": "Web fetch tool configuration object",
              "additionalProperties": false
            }
          ]
        },
        "web-search": {
          "description": "Web search tool for performing internet searches and retrieving search results (subject to network permissions)",
          "oneOf": [
            {
              "type": "null",
              "description": "Enable web search tool with default configuration"
            },
            {
              "type": "object",
              "description": "Web search tool configuration object",
              "additionalProperties": false
            }
          ]
        },
        "timeout": {
          "type": "integer",
          "minimum": 1,
          "description": "Timeout in seconds for tool/MCP server operations. Applies to all tools and MCP servers if supported by the engine. Default varies by engine (Claude: 60s, Codex: 120s).",
          "examples": [60, 120, 300]
        },
        "startup-timeout": {
          "type": "integer",
          "minimum": 1,
          "description": "Timeout in seconds for MCP server startup. Applies to MCP server initialization if supported by the engine. Default: 120 seconds."
        }
      },
      "additionalProperties": {
        "description": "Custom tool configuration",
        "oneOf": [
          {
            "type": "string",
            "description": "Simple tool string"
          },
          {
            "type": "object",
            "description": "Custom tool object configuration",
            "properties": {
              "mcp": {
                "description": "MCP server configuration",
                "additionalProperties": true
              },
              "allowed": {
                "type": "array",
                "description": "List of allowed tool functions",
                "items": {
                  "type": "string"
                }
              }
            },
            "additionalProperties": true
          }
        ]
      }
    },
    "engine": {
      "description": "AI engine configuration for included files. Defaults to 'copilot'.",
      "default": "copilot",
      "$ref": "#/$defs/engine_config"
    },
    "safe-outputs": {
      "type": "object",
      "description": "Safe outputs configuration (only jobs allowed in included files)",
      "properties": {
        "jobs": {
          "type": "object",
          "description": "Custom safe-job definitions",
          "patternProperties": {
            "^[a-zA-Z0-9_-]+$": {
              "$ref": "#/$defs/safe_job"
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "safe-inputs": {
      "type": "object",
      "description": "Safe inputs configuration for custom MCP tools defined as JavaScript, shell scripts, or Python scripts. Tools are mounted in an MCP server and have access to secrets specified in the env field.",
      "additionalProperties": {
        "type": "object",
        "description": "Tool definition for a safe-input custom tool",
        "properties": {
          "description": {
            "type": "string",
            "description": "Required description of what the tool does. This is shown to the AI agent."
          },
          "inputs": {
            "type": "object",
            "description": "Input parameters for the tool, using workflow_dispatch input syntax",
            "maxProperties": 25,
            "additionalProperties": {
              "type": "object",
              "properties": {
                "type": {
                  "type": "string",
                  "enum": ["string", "number", "boolean", "array", "object"],
                  "description": "JSON schema type for the input parameter"
                },
                "description": {
                  "type": "string",
                  "description": "Description of the input parameter"
                },
                "required": {
                  "type": "boolean",
                  "description": "Whether the input is required"
                },
                "default": {
                  "description": "Default value for the input"
                }
              },
              "additionalProperties": false
            }
          },
          "script": {
            "type": "string",
            "description": "JavaScript implementation (CommonJS). The script should export an execute function. Mutually exclusive with 'run' and 'py'."
          },
          "run": {
            "type": "string",
            "description": "Shell script implementation. Input parameters are available as INPUT_<NAME> environment variables. Mutually exclusive with 'script' and 'py'."
          },
          "py": {
            "type": "string",
            "description": "Python script implementation. Input parameters are available as INPUT_<NAME> environment variables. Mutually exclusive with 'script' and 'run'."
          },
          "env": {
            "type": "object",
            "description": "Environment variables for the tool, typically used for passing secrets",
            "additionalProperties": {
              "type": "string"
            }
          },
          "timeout": {
            "type": "integer",
            "description": "Timeout in seconds for tool execution. Default is 60 seconds. Applies to shell (run) and Python (py) tools.",
            "default": 60,
            "minimum": 1,
            "examples": [30, 60, 120, 300]
          }
        },
        "required": ["description"],
        "additionalProperties": false
      }
    },
    "secret-masking": {
      "type": "object",
      "description": "Secret masking configuration to be merged with main workflow",
      "properties": {
        "steps": {
          "type": "array",
          "description": "Additional secret redaction steps to inject after the built-in secret redaction",
          "items": {
            "type": "object",
            "additionalProperties": true
          }
        }
      },
      "additionalProperties": false
    },
    "runtimes": {
      "type": "object",
      "description": "Runtime environment version overrides. Allows customizing runtime versions (e.g., Node.js, Python) or defining new runtimes. Merged with main workflow runtimes.",
      "patternProperties": {
        "^[a-z][a-z0-9-]*$": {
          "type": "object",
          "description": "Runtime configuration object identified by runtime ID (e.g., 'node', 'python', 'go')",
          "properties": {
            "version": {
              "oneOf": [
                {
                  "type": "string",
                  "description": "Runtime version as a string (e.g., '22', '3.12', 'latest')"
                },
                {
                  "type": "number",
                  "description": "Runtime version as a number (e.g., 22, 3.12)"
                }
              ]
            },
            "action-repo": {
              "type": "string",
              "description": "GitHub Actions repository for setting up the runtime (e.g., 'actions/setup-node', 'custom/setup-runtime'). Overrides the default setup action."
            },
            "action-version": {
              "type": "string",
              "description": "Version of the setup action to use (e.g., 'v4', 'v5'). Overrides the default action version."
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "network": {
      "description": "Network permissions configuration for allowed domains. Supports wildcard patterns like '*.example.com' (matches sub.example.com and example.com itself).",
      "oneOf": [
        {
          "type": "string",
          "enum": ["defaults"],
          "description": "Use default network access"
        },
        {
          "type": "object",
          "description": "Network permissions object",
          "properties": {
            "allowed": {
              "type": "array",
              "description": "List of allowed domains, wildcard patterns (e.g., '*.example.com'), or ecosystem identifiers (e.g., 'python', 'node')",
              "items": {
                "type": "string"
              }
            },
            "firewall": {
              "description": "AWF (Agent Workflow Firewall) configuration for network egress control. Only supported for Copilot engine.",
              "deprecated": true,
              "x-deprecation-message": "The firewall is now always enabled. Use 'sandbox.agent' to configure the sandbox type.",
              "oneOf": [
                {
                  "type": "null",
                  "description": "Enable AWF with default settings (equivalent to empty object)"
                },
                {
                  "type": "boolean",
                  "description": "Enable (true) or explicitly disable (false) AWF firewall"
                },
                {
                  "type": "string",
                  "enum": ["disable"],
                  "description": "Disable AWF firewall (triggers warning if allowed != *, error in strict mode if allowed is not * or engine does not support firewall)"
                },
                {
                  "type": "object",
                  "description": "Custom AWF configuration with version and arguments",
                  "properties": {
                    "args": {
                      "type": "array",
                      "description": "Optional additional arguments to pass to AWF wrapper",
                      "items": {
                        "type": "string"
                      }
                    },
                    "version": {
                      "type": ["string", "number"],
                      "description": "AWF version to use (empty = latest release). Can be a string (e.g., 'v1.0.0', 'latest') or number (e.g., 20, 3.11). Numeric values are automatically converted to strings at runtime.",
                      "examples": ["v1.0.0", "latest", 20, 3.11]
                    },
                    "log-level": {
                      "type": "string",
                      "description": "AWF log level (default: info). Valid values: debug, info, warn, error",
                      "enum": ["debug", "info", "warn", "error"]
                    },
                    "ssl-bump": {
                      "type": "boolean",
                      "description": "AWF-only feature: Enable SSL Bump for HTTPS content inspection. When enabled, AWF can filter HTTPS traffic by URL patterns instead of just domain names. This feature is specific to AWF and does not apply to Sandbox Runtime (SRT). Default: false",
                      "default": false
                    },
                    "allow-urls": {
                      "type": "array",
                      "description": "AWF-only feature: URL patterns to allow for HTTPS traffic (requires ssl-bump: true). Supports wildcards for flexible path matching. Must include https:// scheme. This feature is specific to AWF and does not apply to Sandbox Runtime (SRT).",
                      "items": {
                        "type": "string",
                        "pattern": "^https://.*",
                        "description": "HTTPS URL pattern with optional wildcards (e.g., 'https://github.com/githubnext/*')"
                      },
                      "examples": [["https://github.com/githubnext/*", "https://api.github.com/repos/*"]]
                    }
                  },
                  "additionalProperties": false
                }
              ]
            }
          },
          "additionalProperties": false
        }
      ]
    },
    "permissions": {
      "description": "GitHub Actions permissions for the workflow (merged with main workflow permissions)",
      "oneOf": [
        {
          "type": "string",
          "enum": ["read-all", "write-all", "read", "write"],
          "description": "Simple permissions string: 'read-all' (all read permissions), 'write-all' (all write permissions), 'read' or 'write' (basic level)"
        },
        {
          "type": "object",
          "description": "Permission scopes and levels",
          "properties": {
            "actions": {
              "type": "string",
              "enum": ["read", "write", "none"],
              "description": "Permission for GitHub Actions"
            },
            "checks": {
              "type": "string",
              "enum": ["read", "write", "none"],
              "description": "Permission for checks"
            },
            "contents": {
              "type": "string",
              "enum": ["read", "write", "none"],
              "description": "Permission for repository contents"
            },
            "deployments": {
              "type": "string",
              "enum": ["read", "write", "none"],
              "description": "Permission for deployments"
            },
            "discussions": {
              "type": "string",
              "enum": ["read", "write", "none"],
              "description": "Permission for discussions"
            },
            "id-token": {
              "type": "string",
              "enum": ["read", "write", "none"],
              "description": "Permission for ID token"
            },
            "issues": {
              "type": "string",
              "enum": ["read", "write", "none"],
              "description": "Permission for issues"
            },
            "metadata": {
              "type": "string",
              "enum": ["read", "write", "none"],
              "description": "Permission for metadata"
            },
            "packages": {
              "type": "string",
              "enum": ["read", "write", "none"],
              "description": "Permission for packages"
            },
            "pages": {
              "type": "string",
              "enum": ["read", "write", "none"],
              "description": "Permission for GitHub Pages"
            },
            "pull-requests": {
              "type": "string",
              "enum": ["read", "write", "none"],
              "description": "Permission for pull requests"
            },
            "security-events": {
              "type": "string",
              "enum": ["read", "write", "none"],
              "description": "Permission for security events"
            },
            "statuses": {
              "type": "string",
              "enum": ["read", "write", "none"],
              "description": "Permission for commit statuses"
            },
            "attestations": {
              "type": "string",
              "enum": ["read", "write", "none"],
              "description": "Permission for attestations"
            },
            "models": {
              "type": "string",
              "enum": ["read", "write", "none"],
              "description": "Permission for AI models"
            }
          },
          "additionalProperties": false
        }
      ]
    }
  },
  "additionalProperties": false,
  "$defs": {
    "stdio_mcp_tool": {
      "type": "object",
      "description": "Stdio MCP tool configuration",
      "properties": {
        "type": {
          "type": "string",
          "enum": ["stdio", "local"],
          "description": "MCP connection type for stdio (local is an alias for stdio)"
        },
        "registry": {
          "type": "string",
          "description": "URI to the installation location when MCP is installed from a registry"
        },
        "command": {
          "type": "string",
          "minLength": 1,
          "$comment": "Mutually exclusive with 'container' - only one execution mode can be specified. Validated by 'not.allOf' constraint below.",
          "description": "Command for stdio MCP connections"
        },
        "container": {
          "type": "string",
          "pattern": "^[a-zA-Z0-9][a-zA-Z0-9/:_.-]*$",
          "$comment": "Mutually exclusive with 'command' - only one execution mode can be specified. Validated by 'not.allOf' constraint below.",
          "description": "Container image for stdio MCP connections"
        },
        "version": {
          "type": ["string", "number"],
          "description": "Optional version/tag for the container image (e.g., 'latest', 'v1.0.0', 20, 3.11). Numeric values are automatically converted to strings at runtime.",
          "examples": ["latest", "v1.0.0", 20, 3.11]
        },
        "args": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Arguments for command or container execution"
        },
        "entrypointArgs": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Arguments to add after the container image (container entrypoint arguments)"
        },
        "env": {
          "type": "object",
          "patternProperties": {
            "^[A-Z_][A-Z0-9_]*$": {
              "type": "string"
            }
          },
          "additionalProperties": false,
          "description": "Environment variables for MCP server"
        },
        "network": {
          "type": "object",
          "$comment": "Requires 'container' to be specified - network configuration only applies to container-based MCP servers. Validated by 'if/then' constraint in 'allOf' below.",
          "properties": {
            "allowed": {
              "type": "array",
              "items": {
                "type": "string",
                "pattern": "^[a-zA-Z0-9]([a-zA-Z0-9\\-]{0,61}[a-zA-Z0-9])?(\\.[a-zA-Z0-9]([a-zA-Z0-9\\-]{0,61}[a-zA-Z0-9])?)*$",
                "description": "Allowed domain name"
              },
              "minItems": 1,
              "uniqueItems": true,
              "description": "List of allowed domain names for network access"
            },
            "proxy-args": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "description": "Custom proxy arguments for container-based MCP servers"
            }
          },
          "additionalProperties": false,
          "description": "Network configuration for container-based MCP servers"
        },
        "allowed": {
          "type": "array",
          "description": "List of allowed tool functions",
          "items": {
            "type": "string"
          }
        }
      },
      "additionalProperties": false,
      "$comment": "Validation constraints: (1) Mutual exclusion: 'command' and 'container' cannot both be specified. (2) Requirement: Either 'command' or 'container' must be provided (via 'anyOf'). (3) Dependency: 'network' requires 'container' (validated in 'allOf'). (4) Type constraint: When 'type' is 'stdio' or 'local', either 'command' or 'container' is required.",
      "anyOf": [
        {
          "required": ["type"]
        },
        {
          "required": ["command"]
        },
        {
          "required": ["container"]
        }
      ],
      "not": {
        "allOf": [
          {
            "required": ["command"]
          },
          {
            "required": ["container"]
          }
        ]
      },
      "allOf": [
        {
          "if": {
            "required": ["network"]
          },
          "then": {
            "required": ["container"]
          }
        },
        {
          "if": {
            "properties": {
              "type": {
                "enum": ["stdio", "local"]
              }
            }
          },
          "then": {
            "anyOf": [
              {
                "required": ["command"]
              },
              {
                "required": ["container"]
              }
            ]
          }
        }
      ]
    },
    "http_mcp_tool": {
      "type": "object",
      "description": "HTTP MCP tool configuration",
      "properties": {
        "type": {
          "type": "string",
          "enum": ["http"],
          "description": "MCP connection type for HTTP"
        },
        "registry": {
          "type": "string",
          "description": "URI to the installation location when MCP is installed from a registry"
        },
        "url": {
          "type": "string",
          "minLength": 1,
          "description": "URL for HTTP MCP connections"
        },
        "headers": {
          "type": "object",
          "patternProperties": {
            "^[A-Za-z0-9_-]+$": {
              "type": "string"
            }
          },
          "additionalProperties": false,
          "description": "HTTP headers for HTTP MCP connections"
        },
        "allowed": {
          "type": "array",
          "description": "List of allowed tool functions",
          "items": {
            "type": "string"
          }
        }
      },
      "required": ["url"],
      "additionalProperties": false
    },
    "safe_job": {
      "type": "object",
      "description": "Custom safe-job configuration",
      "properties": {
        "name": {
          "type": "string",
          "description": "Display name for the job"
        },
        "description": {
          "type": "string",
          "description": "Description of the safe-job (used in MCP tool registration)"
        },
        "runs-on": {
          "oneOf": [
            {
              "type": "string",
              "description": "Runner type (e.g., 'ubuntu-latest')"
            },
            {
              "type": "array",
              "items": {
                "type": "string"
              },
              "description": "Array of runner types"
            }
          ],
          "description": "GitHub Actions runner specification"
        },
        "if": {
          "type": "string",
          "description": "Conditional execution expression"
        },
        "needs": {
          "oneOf": [
            {
              "type": "string",
              "description": "Single job dependency"
            },
            {
              "type": "array",
              "items": {
                "type": "string"
              },
              "description": "Array of job dependencies"
            }
          ]
        },
        "steps": {
          "type": "array",
          "description": "GitHub Actions steps",
          "items": {
            "type": "object",
            "additionalProperties": true
          }
        },
        "env": {
          "type": "object",
          "description": "Environment variables",
          "additionalProperties": {
            "type": "string"
          }
        },
        "permissions": {
          "type": "object",
          "description": "Job-level permissions",
          "additionalProperties": {
            "type": "string"
          }
        },
        "inputs": {
          "type": "object",
          "description": "Input parameters for the safe-job (required)",
          "patternProperties": {
            "^[a-zA-Z0-9_-]+$": {
              "type": "object",
              "properties": {
                "description": {
                  "type": "string",
                  "description": "Input description"
                },
                "required": {
                  "type": "boolean",
                  "description": "Whether the input is required"
                },
                "default": {
                  "type": "string",
                  "description": "Default value"
                },
                "type": {
                  "type": "string",
                  "enum": ["string", "number", "boolean", "choice"],
                  "description": "Input type"
                },
                "options": {
                  "type": "array",
                  "items": {
                    "type": "string"
                  },
                  "description": "Options for choice type"
                }
              },
              "additionalProperties": false
            }
          },
          "minProperties": 1,
          "additionalProperties": false
        },
        "github-token": {
          "type": "string",
          "description": "Custom GitHub token"
        },
        "output": {
          "type": "string",
          "description": "Custom output message"
        }
      },
      "required": ["inputs"],
      "additionalProperties": false
    },
    "engine_config": {
      "examples": [
        "claude",
        "copilot",
        {
          "id": "claude",
          "model": "claude-3-5-sonnet-20241022",
          "max-turns": 15
        },
        {
          "id": "copilot",
          "version": "beta"
        },
        {
          "id": "claude",
          "concurrency": {
            "group": "gh-aw-claude",
            "cancel-in-progress": false
          }
        }
      ],
      "oneOf": [
        {
          "type": "string",
          "enum": ["claude", "codex", "copilot", "custom"],
          "description": "Simple engine name: 'claude' (default, Claude Code), 'copilot' (GitHub Copilot CLI), 'codex' (OpenAI Codex CLI), or 'custom' (user-defined steps)"
        },
        {
          "type": "object",
          "description": "Extended engine configuration object with advanced options for model selection, turn limiting, environment variables, and custom steps",
          "properties": {
            "id": {
              "type": "string",
              "enum": ["claude", "codex", "custom", "copilot"],
              "description": "AI engine identifier: 'claude' (Claude Code), 'codex' (OpenAI Codex CLI), 'copilot' (GitHub Copilot CLI), or 'custom' (user-defined GitHub Actions steps)"
            },
            "version": {
              "type": ["string", "number"],
              "description": "Optional version of the AI engine action (e.g., 'beta', 'stable', 20). Has sensible defaults and can typically be omitted. Numeric values are automatically converted to strings at runtime.",
              "examples": ["beta", "stable", 20, 3.11]
            },
            "model": {
              "type": "string",
              "description": "Optional specific LLM model to use (e.g., 'claude-3-5-sonnet-20241022', 'gpt-4'). Has sensible defaults and can typically be omitted."
            },
            "max-turns": {
              "oneOf": [
                {
                  "type": "integer",
                  "description": "Maximum number of chat iterations per run as an integer value"
                },
                {
                  "type": "string",
                  "description": "Maximum number of chat iterations per run as a string value"
                }
              ],
              "description": "Maximum number of chat iterations per run. Helps prevent runaway loops and control costs. Has sensible defaults and can typically be omitted. Note: Only supported by the claude engine."
            },
            "concurrency": {
              "oneOf": [
                {
                  "type": "string",
                  "description": "Simple concurrency group name. Gets converted to GitHub Actions concurrency format with the specified group."
                },
                {
                  "type": "object",
                  "description": "GitHub Actions concurrency configuration for the agent job. Controls how many agentic workflow runs can run concurrently.",
                  "properties": {
                    "group": {
                      "type": "string",
                      "description": "Concurrency group identifier. Use GitHub Actions expressions like ${{ github.workflow }} or ${{ github.ref }}. Defaults to 'gh-aw-{engine-id}' if not specified."
                    },
                    "cancel-in-progress": {
                      "type": "boolean",
                      "description": "Whether to cancel in-progress runs of the same concurrency group. Defaults to false for agentic workflow runs."
                    }
                  },
                  "required": ["group"],
                  "additionalProperties": false
                }
              ],
              "description": "Agent job concurrency configuration. Defaults to single job per engine across all workflows (group: 'gh-aw-{engine-id}'). Supports full GitHub Actions concurrency syntax."
            },
            "user-agent": {
              "type": "string",
              "description": "Custom user agent string for GitHub MCP server configuration (codex engine only)"
            },
            "command": {
              "type": "string",
              "description": "Custom executable path for the AI engine CLI. When specified, the workflow will skip the standard installation steps and use this command instead. The command should be the full path to the executable or a command available in PATH."
            },
            "env": {
              "type": "object",
              "description": "Custom environment variables to pass to the AI engine, including secret overrides (e.g., OPENAI_API_KEY: ${{ secrets.CUSTOM_KEY }})",
              "additionalProperties": {
                "type": "string"
              }
            },
            "steps": {
              "type": "array",
              "description": "Custom GitHub Actions steps for 'custom' engine. Define your own deterministic workflow steps instead of using AI processing.",
              "items": {
                "type": "object",
                "additionalProperties": true
              }
            },
            "error_patterns": {
              "type": "array",
              "description": "Custom error patterns for validating agent logs",
              "items": {
                "type": "object",
                "description": "Error pattern definition",
                "properties": {
                  "id": {
                    "type": "string",
                    "description": "Unique identifier for this error pattern"
                  },
                  "pattern": {
                    "type": "string",
                    "description": "Ecma script regular expression pattern to match log lines"
                  },
                  "level_group": {
                    "type": "integer",
                    "minimum": 0,
                    "description": "Capture group index (1-based) that contains the error level. Use 0 to infer from pattern content."
                  },
                  "message_group": {
                    "type": "integer",
                    "minimum": 0,
                    "description": "Capture group index (1-based) that contains the error message. Use 0 to use the entire match."
                  },
                  "description": {
                    "type": "string",
                    "description": "Human-readable description of what this pattern matches"
                  }
                },
                "required": ["pattern"],
                "additionalProperties": false
              }
            },
            "config": {
              "type": "string",
              "description": "Additional TOML configuration text that will be appended to the generated config.toml in the action (codex engine only)"
            },
            "args": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "description": "Optional array of command-line arguments to pass to the AI engine CLI. These arguments are injected after all other args but before the prompt."
            }
          },
          "required": ["id"],
          "additionalProperties": false
        }
      ]
    }
  }
}

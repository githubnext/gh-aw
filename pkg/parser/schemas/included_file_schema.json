{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "object",
  "properties": {
    "mcp-servers": {
      "type": "object",
      "description": "MCP server definitions that can be imported into workflows",
      "patternProperties": {
        "^[a-zA-Z0-9_-]+$": {
          "oneOf": [
            {
              "$ref": "#/$defs/stdio_mcp_tool"
            },
            {
              "$ref": "#/$defs/http_mcp_tool"
            }
          ]
        }
      },
      "additionalProperties": false
    },
    "steps": {
      "description": "Custom workflow steps to be merged with main workflow",
      "oneOf": [
        {
          "type": "object",
          "additionalProperties": true
        },
        {
          "type": "array",
          "items": {
            "oneOf": [
              {
                "type": "string"
              },
              {
                "type": "object",
                "additionalProperties": true
              }
            ]
          }
        }
      ]
    },
    "tools": {
      "type": "object",
      "description": "Tools configuration for the included file",
      "properties": {
        "bash": {
          "description": "Bash shell command execution tool for running command-line programs and scripts",
          "oneOf": [
            {
              "type": "null",
              "description": "Enable bash tool with all shell commands allowed"
            },
            {
              "type": "array",
              "description": "List of allowed bash commands and patterns (e.g., ['ast-grep:*', 'sg:*'])",
              "items": {
                "type": "string"
              }
            }
          ]
        },
        "github": {
          "description": "GitHub tools configuration",
          "oneOf": [
            {
              "type": "string",
              "description": "Simple github tool string"
            },
            {
              "type": "object",
              "description": "GitHub tools object configuration",
              "properties": {
                "allowed": {
                  "type": "array",
                  "description": "List of allowed GitHub tools",
                  "items": {
                    "type": "string"
                  }
                }
              },
              "additionalProperties": true
            }
          ]
        },
        "claude": {
          "description": "Claude tools configuration",
          "oneOf": [
            {
              "type": "string",
              "description": "Simple claude tool string"
            },
            {
              "type": "object",
              "description": "Claude tools object configuration",
              "properties": {
                "allowed": {
                  "description": "Allowed Claude tools",
                  "oneOf": [
                    {
                      "type": "array",
                      "items": {
                        "type": "string"
                      }
                    },
                    {
                      "type": "object",
                      "additionalProperties": true
                    }
                  ]
                }
              },
              "additionalProperties": true
            }
          ]
        }
      },
      "additionalProperties": {
        "description": "Custom tool configuration",
        "oneOf": [
          {
            "type": "string",
            "description": "Simple tool string"
          },
          {
            "type": "object",
            "description": "Custom tool object configuration",
            "properties": {
              "mcp": {
                "description": "MCP server configuration",
                "additionalProperties": true
              },
              "allowed": {
                "type": "array",
                "description": "List of allowed tool functions",
                "items": {
                  "type": "string"
                }
              }
            },
            "additionalProperties": true
          }
        ]
      }
    },
    "engine": {
    "description": "AI engine configuration for included files",
    "oneOf": [
      {
        "type": "string",
        "enum": [
          "claude",
          "codex",
          "custom"
        ],
        "description": "Simple engine name (claude, codex, or custom)"
      },
      {
        "type": "object",
        "description": "Extended engine configuration object",
        "properties": {
          "id": {
            "type": "string",
            "enum": [
              "claude",
              "codex",
              "custom"
            ],
            "description": "Agent CLI identifier (claude, codex, or custom)"
          },
          "version": {
            "type": "string",
            "description": "Optional version of the action"
          },
          "model": {
            "type": "string",
            "description": "Optional LLM model to use"
          },
          "max-turns": {
            "type": "integer",
            "description": "Maximum number of chat iterations per run"
          },
          "env": {
            "type": "object",
            "description": "Custom environment variables to pass to the agentic engine",
            "additionalProperties": {
              "type": "string"
            }
          },
          "steps": {
            "type": "array",
            "description": "Custom GitHub Actions steps (for custom engine)",
            "items": {
              "type": "object",
              "additionalProperties": true
            }
          }
        },
        "required": [
          "id"
        ],
        "additionalProperties": false
      }
    ]
  }
},
"additionalProperties": false,
"$defs": {
  "stdio_mcp_tool": {
    "type": "object",
    "description": "Stdio MCP tool configuration",
    "properties": {
      "type": {
        "type": "string",
        "enum": [
          "stdio",
          "local"
        ],
        "description": "MCP connection type for stdio (local is an alias for stdio)"
      },
      "registry": {
        "type": "string",
        "description": "URI to the installation location when MCP is installed from a registry"
      },
      "command": {
        "type": "string",
        "description": "Command for stdio MCP connections"
      },
      "container": {
        "type": "string",
        "pattern": "^[a-zA-Z0-9][a-zA-Z0-9/:_.-]*$",
        "description": "Container image for stdio MCP connections (alternative to command)"
      },
      "version": {
        "type": "string",
        "description": "Optional version/tag for the container image (e.g., 'latest', 'v1.0.0')"
      },
      "args": {
        "type": "array",
        "items": {
          "type": "string"
        },
        "description": "Arguments for command or container execution"
      },
      "env": {
        "type": "object",
        "patternProperties": {
          "^[A-Z_][A-Z0-9_]*$": {
            "type": "string"
          }
        },
        "additionalProperties": false,
        "description": "Environment variables for MCP server"
      },
      "network": {
        "type": "object",
        "properties": {
          "allowed": {
            "type": "array",
            "items": {
              "type": "string",
              "pattern": "^[a-zA-Z0-9]([a-zA-Z0-9\\-]{0,61}[a-zA-Z0-9])?(\\.[a-zA-Z0-9]([a-zA-Z0-9\\-]{0,61}[a-zA-Z0-9])?)*$",
              "description": "Allowed domain name"
            },
            "minItems": 1,
            "uniqueItems": true,
            "description": "List of allowed domain names for network access"
          },
          "proxy-args": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Custom proxy arguments for container-based MCP servers"
          }
        },
        "additionalProperties": false,
        "description": "Network configuration for container-based MCP servers"
      },
      "allowed": {
        "type": "array",
        "description": "List of allowed tool functions",
        "items": {
          "type": "string"
        }
      }
    },
    "additionalProperties": false,
    "anyOf": [
      {
        "required": [
          "command"
        ]
      },
      {
        "required": [
          "container"
        ]
      }
    ],
    "not": {
      "allOf": [
        {
          "required": [
            "command"
          ]
        },
        {
          "required": [
            "container"
          ]
        }
      ]
    },
    "allOf": [
      {
        "if": {
          "required": [
            "network"
          ]
        },
        "then": {
          "required": [
            "container"
          ]
        }
      }
    ]
  },
  "http_mcp_tool": {
    "type": "object",
    "description": "HTTP MCP tool configuration",
    "properties": {
      "type": {
        "type": "string",
        "const": "http",
        "description": "MCP connection type for HTTP"
      },
      "registry": {
        "type": "string",
        "description": "URI to the installation location when MCP is installed from a registry"
      },
      "url": {
        "type": "string",
        "description": "URL for HTTP MCP connections"
      },
      "headers": {
        "type": "object",
        "patternProperties": {
          "^[A-Za-z0-9-]+$": {
            "type": "string"
          }
        },
        "additionalProperties": false,
        "description": "HTTP headers for HTTP MCP connections"
      },
      "allowed": {
        "type": "array",
        "description": "List of allowed tool functions",
        "items": {
          "type": "string"
        }
      }
    },
    "required": [
      "url"
    ],
    "additionalProperties": false
  }
}
}
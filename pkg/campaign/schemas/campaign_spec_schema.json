{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://github.com/githubnext/gh-aw/schemas/campaign_spec_schema.json",
  "title": "Campaign Spec Schema",
  "description": "Schema for GitHub Agentic Workflows campaign specifications",
  "type": "object",
  "properties": {
    "id": {
      "type": "string",
      "description": "Unique identifier for the campaign (lowercase letters, digits, and hyphens only)",
      "pattern": "^[a-z0-9-]+$",
      "minLength": 1
    },
    "name": {
      "type": "string",
      "description": "Human-readable name for the campaign",
      "minLength": 1
    },
    "description": {
      "type": "string",
      "description": "Brief description of the campaign"
    },
    "objective": {
      "type": "string",
      "description": "Outcome-owned objective statement for the campaign (what success means)",
      "minLength": 1
    },
    "kpis": {
      "type": "array",
      "description": "Up to 3 KPIs used to measure the campaign objective",
      "minItems": 1,
      "maxItems": 3,
      "items": {
        "type": "object",
        "additionalProperties": false,
        "properties": {
          "id": {
            "type": "string",
            "description": "Optional stable identifier for the KPI (lowercase letters, digits, and hyphens)",
            "pattern": "^[a-z0-9-]+$",
            "minLength": 1
          },
          "name": {
            "type": "string",
            "description": "Human-readable KPI name",
            "minLength": 1
          },
          "priority": {
            "type": "string",
            "description": "KPI priority: primary (exactly one per campaign) or supporting",
            "enum": ["primary", "supporting"]
          },
          "unit": {
            "type": "string",
            "description": "Optional KPI unit (e.g., percent, days, count)",
            "minLength": 1
          },
          "baseline": {
            "type": "number",
            "description": "Baseline KPI value"
          },
          "target": {
            "type": "number",
            "description": "Target KPI value"
          },
          "time-window-days": {
            "type": "integer",
            "description": "Rolling time window, in days, used for KPI measurement (e.g., 7, 14, 30)",
            "minimum": 1
          },
          "direction": {
            "type": "string",
            "description": "Whether improvement means increasing or decreasing the KPI",
            "enum": ["increase", "decrease"]
          },
          "source": {
            "type": "string",
            "description": "Signal source used to compute this KPI",
            "enum": ["ci", "pull_requests", "code_security", "custom"]
          }
        },
        "required": ["name", "baseline", "target", "time-window-days"]
      }
    },
    "project-url": {
      "type": "string",
      "description": "URL of the GitHub Project used as the primary campaign dashboard",
      "format": "uri",
      "pattern": "/projects/",
      "minLength": 1
    },
    "project-github-token": {
      "type": "string",
      "description": "Optional GitHub token expression used for GitHub Projects v2 operations (e.g., ${{ secrets.GH_AW_PROJECT_GITHUB_TOKEN }})",
      "minLength": 1
    },
    "version": {
      "type": "string",
      "description": "Spec version (e.g., v1)",
      "pattern": "^v[0-9]+$",
      "default": "v1"
    },
    "workflows": {
      "type": "array",
      "description": "List of workflow IDs (basenames without .md) implementing this campaign",
      "items": {
        "type": "string",
        "minLength": 1
      },
      "minItems": 1
    },
    "discovery-repos": {
      "type": "array",
      "description": "List of repositories (in owner/repo format) where worker workflows are discovered. This controls the scope of GitHub searches for issues/PRs created by worker workflows.",
      "items": {
        "type": "string",
        "pattern": "^[a-zA-Z0-9_.-]+/[a-zA-Z0-9_.-]+$",
        "minLength": 1
      },
      "minItems": 1
    },
    "discovery-orgs": {
      "type": "array",
      "description": "List of GitHub organizations where worker workflows are discovered. When specified, any repository within these organizations is searched for worker-created issues/PRs.",
      "items": {
        "type": "string",
        "pattern": "^[a-zA-Z0-9_.-]+$",
        "minLength": 1
      }
    },
    "allowed-repos": {
      "type": "array",
      "description": "Optional list of repositories (in owner/repo format) that this campaign is allowed to discover and operate on. When omitted, defaults to the current repository where the campaign is defined.",
      "items": {
        "type": "string",
        "pattern": "^[a-zA-Z0-9_.-]+/[a-zA-Z0-9_.-]+$",
        "minLength": 1
      },
      "minItems": 1
    },
    "allowed-orgs": {
      "type": "array",
      "description": "Optional list of GitHub organizations that this campaign is allowed to discover and operate on",
      "items": {
        "type": "string",
        "pattern": "^[a-zA-Z0-9_.-]+$",
        "minLength": 1
      }
    },
    "memory-paths": {
      "type": "array",
      "description": "Paths where this campaign writes its repo-memory",
      "items": {
        "type": "string",
        "minLength": 1
      }
    },
    "metrics-glob": {
      "type": "string",
      "description": "Glob pattern to locate JSON metrics snapshots in memory/campaigns branch"
    },
    "cursor-glob": {
      "type": "string",
      "description": "Glob pattern to locate a durable cursor/checkpoint file in memory/campaigns branch",
      "pattern": "^memory/campaigns/",
      "minLength": 1
    },
    "owners": {
      "type": "array",
      "description": "Primary human owners for this campaign",
      "items": {
        "type": "string",
        "minLength": 1
      }
    },
    "executive-sponsors": {
      "type": "array",
      "description": "Executive stakeholders or sponsors",
      "items": {
        "type": "string",
        "minLength": 1
      }
    },
    "risk-level": {
      "type": "string",
      "description": "Risk level (e.g., low, medium, high)",
      "enum": ["low", "medium", "high"]
    },
    "state": {
      "type": "string",
      "description": "Lifecycle stage of the campaign",
      "enum": ["planned", "active", "paused", "completed", "archived"]
    },
    "tags": {
      "type": "array",
      "description": "Free-form categorization tags",
      "items": {
        "type": "string",
        "minLength": 1
      }
    },
    "allowed-safe-outputs": {
      "type": "array",
      "description": "Safe-outputs operations this campaign is expected to use",
      "items": {
        "type": "string",
        "minLength": 1
      }
    },
    "approval-policy": {
      "type": "object",
      "description": "Approval expectations for this campaign",
      "properties": {
        "required-approvals": {
          "type": "integer",
          "description": "Number of required approvals",
          "minimum": 0
        },
        "required-roles": {
          "type": "array",
          "description": "Required roles for approval",
          "items": {
            "type": "string",
            "minLength": 1
          }
        },
        "change-control": {
          "type": "boolean",
          "description": "Whether change control is required"
        }
      },
      "additionalProperties": false
    },
    "launcher": {
      "type": "object",
      "description": "Optional launcher layer configuration. When omitted, the launcher is enabled by default.",
      "properties": {
        "enabled": {
          "type": "boolean",
          "description": "Whether to generate and compile the campaign launcher workflow"
        }
      },
      "additionalProperties": false
    },
    "engine": {
      "type": "string",
      "description": "AI engine to use for the campaign orchestrator",
      "enum": ["copilot", "claude", "codex", "custom"]
    },
    "bootstrap": {
      "type": "object",
      "description": "Initial work item creation strategy when discovery returns zero items",
      "properties": {
        "mode": {
          "type": "string",
          "description": "Bootstrap strategy: seeder-worker (dispatch scanner), project-todos (read from Project board), manual (skip bootstrap)",
          "enum": ["seeder-worker", "project-todos", "manual"]
        },
        "seeder-worker": {
          "type": "object",
          "description": "Configuration for dispatching a seeder/scanner worker. Only used when mode is 'seeder-worker'.",
          "properties": {
            "workflow-id": {
              "type": "string",
              "description": "Workflow identifier (basename without .md) to dispatch",
              "minLength": 1
            },
            "payload": {
              "type": "object",
              "description": "JSON payload to send to the seeder worker"
            },
            "max-items": {
              "type": "integer",
              "description": "Maximum number of work items the seeder should return (0 = worker default)",
              "minimum": 0
            }
          },
          "required": ["workflow-id", "payload"],
          "additionalProperties": false
        },
        "project-todos": {
          "type": "object",
          "description": "Configuration for reading from Project board's Todo column. Only used when mode is 'project-todos'.",
          "properties": {
            "status-field": {
              "type": "string",
              "description": "Name of the Project status field to filter on (default: 'Status')",
              "minLength": 1
            },
            "todo-value": {
              "type": "string",
              "description": "Status value indicating a work item is ready to start (default: 'Todo')",
              "minLength": 1
            },
            "max-items": {
              "type": "integer",
              "description": "Maximum number of Todo items to process per run (0 = governance default)",
              "minimum": 0
            },
            "require-fields": {
              "type": "array",
              "description": "Project field names that must be populated for an item to be valid work",
              "items": {
                "type": "string",
                "minLength": 1
              }
            }
          },
          "additionalProperties": false
        }
      },
      "required": ["mode"],
      "additionalProperties": false
    },
    "workers": {
      "type": "array",
      "description": "Worker workflow metadata including capabilities, payload schemas, and output labeling contracts",
      "items": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "description": "Workflow identifier (basename without .md)",
            "minLength": 1
          },
          "name": {
            "type": "string",
            "description": "Human-readable worker name",
            "minLength": 1
          },
          "description": {
            "type": "string",
            "description": "Description of what the worker does",
            "minLength": 1
          },
          "capabilities": {
            "type": "array",
            "description": "Types of work this worker can perform",
            "items": {
              "type": "string",
              "minLength": 1
            },
            "minItems": 1
          },
          "payload-schema": {
            "type": "object",
            "description": "Expected structure of the JSON payload",
            "additionalProperties": {
              "type": "object",
              "properties": {
                "type": {
                  "type": "string",
                  "description": "Field data type",
                  "enum": ["string", "number", "boolean", "array", "object"]
                },
                "description": {
                  "type": "string",
                  "description": "Field description",
                  "minLength": 1
                },
                "required": {
                  "type": "boolean",
                  "description": "Whether this field is required"
                },
                "example": {
                  "description": "Sample value for this field"
                }
              },
              "required": ["type", "description"],
              "additionalProperties": false
            }
          },
          "output-labeling": {
            "type": "object",
            "description": "Labeling and metadata contract for worker outputs",
            "properties": {
              "labels": {
                "type": "array",
                "description": "Labels the worker applies to created items (in addition to the campaign's tracker-label)",
                "items": {
                  "type": "string",
                  "minLength": 1
                }
              },
              "key-in-title": {
                "type": "boolean",
                "description": "Whether worker includes deterministic key in title"
              },
              "key-format": {
                "type": "string",
                "description": "Key format when key-in-title is true",
                "minLength": 1
              },
              "metadata-fields": {
                "type": "array",
                "description": "Project fields the worker populates",
                "items": {
                  "type": "string",
                  "minLength": 1
                }
              }
            },
            "required": ["key-in-title"],
            "additionalProperties": false
          },
          "idempotency-strategy": {
            "type": "string",
            "description": "How the worker ensures idempotent execution",
            "enum": ["branch-based", "pr-title-based", "issue-title-based", "cursor-based"]
          },
          "priority": {
            "type": "integer",
            "description": "Worker priority for deterministic selection (higher = higher priority)",
            "minimum": 0
          }
        },
        "required": ["id", "capabilities", "payload-schema", "output-labeling", "idempotency-strategy"],
        "additionalProperties": false
      }
    },
    "governance": {
      "type": "object",
      "description": "Lightweight pacing and opt-out policies for campaign coordinator workflows (launcher/orchestrator)",
      "properties": {
        "max-new-items-per-run": {
          "type": "integer",
          "description": "Maximum number of new items (issues/PRs) the launcher should add to the Project board per run",
          "minimum": 0
        },
        "max-discovery-items-per-run": {
          "type": "integer",
          "description": "Maximum number of candidate issues/PRs to scan during discovery in a single run",
          "minimum": 0
        },
        "max-discovery-pages-per-run": {
          "type": "integer",
          "description": "Maximum number of result pages to fetch during discovery in a single run",
          "minimum": 0
        },
        "opt-out-labels": {
          "type": "array",
          "description": "Labels that opt an issue/PR out of campaign tracking",
          "items": {
            "type": "string",
            "minLength": 1
          }
        },
        "do-not-downgrade-done-items": {
          "type": "boolean",
          "description": "If true, prevent moving Project status backwards (e.g., Done -> In Progress) when issues/PRs are reopened"
        },
        "max-project-updates-per-run": {
          "type": "integer",
          "description": "Maximum number of update-project safe-output operations per run for generated coordinator workflows",
          "minimum": 0
        },
        "max-comments-per-run": {
          "type": "integer",
          "description": "Maximum number of add-comment safe-output operations per run for generated coordinator workflows",
          "minimum": 0
        }
      },
      "additionalProperties": false
    }
  },
  "required": ["id", "name", "project-url"],
  "additionalProperties": false
}

# ðŸ”’ Safe Output Processing

One of the primary security features of GitHub Agentic Workflows is "safe output processing", enabling the creation of GitHub issues, comments, pull requests, and other outputs without giving the agentic portion of the workflow write permissions.

## Overview (`output:`)

The `output:` element of your workflow's frontmatter declares that your agentic workflow should conclude with optional automated actions based on the agentic workflow's output. This enables your workflow to write content that is then automatically processed to create GitHub issues, comments, pull requests, or add labelsâ€”all without giving the agentic portion of the workflow any write permissions.

**How It Works:**
1. The agentic part of your workflow runs with minimal read-only permissions
2. The workflow writes its output to the special `${{ env.GITHUB_AW_OUTPUT }}` environment variable
3. The compiler automatically generates additional jobs that read this output and perform the requested actions
4. Only these generated jobs receive the necessary write permissions

## Available Output Types

### New Issue Creation (`issue:`)

Adding `issue:` to the `output:` section of your workflow declares that the workflow should conclude with the creation of a GitHub issue based on the workflow's output.

```yaml
output:
  issue:
    title-prefix: "[ai] "           # Optional: prefix for issue titles
    labels: [automation, agent]     # Optional: labels to attach to issues
```

The agentic part of your workflow should write its content to `${{ env.GITHUB_AW_OUTPUT }}`. The output should be structured as:
- **First non-empty line**: Becomes the issue title (markdown heading syntax like `# Title` is automatically stripped)
- **Remaining content**: Becomes the issue body

**Example natural language to generate the output:**

```yaml
# Code Analysis Agent

Analyze the latest commit and provide insights.
Write your analysis to ${{ env.GITHUB_AW_OUTPUT }} at the end.

The first line of your output will become the issue title.
The rest will become the issue body.
```

### Issue Comment Creation (`issue_comment:`)

Adding `issue_comment:` to the output section of your workflow declares that the workflow should conclude with posting a comment on the triggering issue or pull request based on the workflow's output.

```yaml
output:
  issue_comment: {}                 # Create comments on issues/PRs from workflow output
```

The agentic part of your workflow should writes its content to `${{ env.GITHUB_AW_OUTPUT }}`. The entire content becomes the comment bodyâ€”no special formatting is required.

**Example natural language to generate the output:**

```markdown
# Issue/PR Analysis Agent

Analyze the issue or pull request and provide feedback.
Write your analysis to ${{ env.GITHUB_AW_OUTPUT }} at the end.

Your entire output will be posted as a comment on the triggering issue or PR.
```

This automatically creates GitHub issues or comments from the workflow's analysis without requiring write permissions on the main job.

### Pull Request Creation (`pull-request:`)

Adding `pull-request:` to the `output:` section of your workflow declares that the workflow should conclude with the creation of a pull request containing code changes generated by the workflow.

```yaml
output:
  pull-request:
    title-prefix: "[ai] "           # Optional: prefix for PR titles
    labels: [automation, ai-agent]  # Optional: labels to attach to PRs
    draft: true                     # Optional: create as draft PR (defaults to true)
```

The agentic part of your workflow should provide output in two ways:
1. **File changes**: Make any file changes in the working directoryâ€”these are automatically collected using `git add -A` and committed
2. **PR description**: Write to `${{ env.GITHUB_AW_OUTPUT }}` with:
   - **First non-empty line**: Becomes the PR title
   - **Remaining content**: Becomes the PR description

**Example natural language to generate the output:**

```markdown
# Code Improvement Agent

Analyze the latest commit and suggest improvements.

1. Make any file changes directly in the working directory
2. Write a PR title and description to ${{ env.GITHUB_AW_OUTPUT }}
```

### Label Addition (`labels:`)

Adding `labels:` to the `output:` section of your workflow declares that the workflow should conclude with adding labels to the current issue or pull request based on the agent's analysis.

```yaml
output:
  labels:
    allowed: [triage, bug, enhancement] # Mandatory: allowed labels for addition
    max-count: 3                        # Optional: maximum number of labels to add (default: 3)
```

The agentic part of your workflow writes should labels to add to `${{ env.GITHUB_AW_OUTPUT }}`, one label per line:
```
triage
bug
needs-review
```

**Safety Features:**

- Empty lines in agent output are ignored
- Lines starting with `-` are rejected (no removal operations allowed)
- Duplicate labels are automatically removed
- All requested labels must be in the `allowed` list or the job fails with a clear error message
- Label count is limited by `max-count` setting (default: 3) - exceeding this limit causes job failure
- Only GitHub's `issues.addLabels` API endpoint is used (no removal endpoints)

**Example natural language to generate the output:**

```markdown
# Issue Labeling Agent

Analyze the issue content and determine appropriate labels.

Write the labels you want to add (one per line) to ${{ env.GITHUB_AW_OUTPUT }}.

Only use labels from the allowed list: triage, bug, enhancement, documentation, needs-review.
```

## Security and Sanitization

All agent output is automatically sanitized for security before being processed:

- **XML Character Escaping**: Special characters (`<`, `>`, `&`, `"`, `'`) are escaped to prevent injection attacks
- **URI Protocol Filtering**: Only HTTPS URIs are allowed; other protocols (HTTP, FTP, file://, javascript:, etc.) are replaced with "(redacted)"
- **Domain Allowlisting**: HTTPS URIs are checked against the `allowed-domains` list. Unlisted domains are replaced with "(redacted)"
- **Default Allowed Domains**: When `allowed-domains` is not specified, safe GitHub domains are used by default:
  - `github.com`
  - `github.io`
  - `githubusercontent.com`
  - `githubassets.com`
  - `github.dev`
  - `codespaces.new`
- **Length and Line Limits**: Content is truncated if it exceeds safety limits (0.5MB or 65,000 lines)
- **Control Character Removal**: Non-printable characters and ANSI escape sequences are stripped

**Configuration:**

```yaml
output:
  allowed-domains:                    # Optional: domains allowed in agent output URIs
    - github.com                      # Default GitHub domains are always included
    - api.github.com                  # Additional trusted domains can be specified
    - trusted-domain.com              # URIs from unlisted domains are replaced with "(redacted)"
```

## Related Documentation

- [Frontmatter Options](frontmatter.md) - All configuration options for workflows
- [Workflow Structure](workflow-structure.md) - Directory layout and organization
- [Alias Triggers](alias-triggers.md) - Special @mention triggers and context text
- [Commands](commands.md) - CLI commands for workflow management

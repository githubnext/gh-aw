# ðŸ”’ Safe Output Processing

One of the primary security features of GitHub Agentic Workflows is "safe output processing", enabling the creation of GitHub issues, comments, pull requests, and other outputs without giving the agentic portion of the workflow write permissions.

## Overview (`safe-outputs:`)

The `safe-outputs:` element of your workflow's frontmatter declares that your agentic workflow should conclude with optional automated actions based on the agentic workflow's output. This enables your workflow to write content that is then automatically processed to create GitHub issues, comments, pull requests, or add labelsâ€”all without giving the agentic portion of the workflow any write permissions.

**How It Works:**
1. The agentic part of your workflow runs with minimal read-only permissions. It is given additional prompting to write its output to the special known files
2. The compiler automatically generates additional jobs that read this output and perform the requested actions
3. Only these generated jobs receive the necessary write permissions

## Available Output Types

### New Issue Creation (`create-issue:`)

Adding `create-issue:` to the `safe-outputs:` section of your workflow declares that the workflow should conclude with the creation of a GitHub issue based on the workflow's output.

```yaml
safe-outputs:
  create-issue:
```

or with further configuration:

```yaml
safe-outputs:
  create-issue:
    title-prefix: "[ai] "           # Optional: prefix for issue titles
    labels: [automation, agent]     # Optional: labels to attach to issues
```

The agentic part of your workflow should describe the issue it wants created.

**Example natural language to generate the output:**

```yaml
# Code Analysis Agent

Analyze the latest commit and provide insights.
Create a new issue with your findings with title "AI Code Analysis" and description "Here are the details of the analysis..."
```

The workflow will have additional prompting describing that, to create the issue, the agent should write the issue title and body to a file.

### Issue Comment Creation (`add-issue-comment:`)

Adding `add-issue-comment:` to the `safe-outputs:` section of your workflow declares that the workflow should conclude with posting a comment on the triggering issue or pull request based on the workflow's output.

```yaml
safe-outputs:
  add-issue-comment:
```

The agentic part of your workflow should describe the comment it wants posted.

**Example natural language to generate the output:**

```markdown
# Issue/PR Analysis Agent

Analyze the issue or pull request and provide feedback.
Create an issue comment on the triggering issue or PR starting with the text "Here is my analysis of the issue/PR..."
```

The workflow will have additional prompting describing that, to create the issue, the agent should write the comment body to a special file..

### Pull Request Creation (`create-pull-request:`)

Adding `create-pull-request:` to the `safe-outputs:` section of your workflow declares that the workflow should conclude with the creation of a pull request containing code changes generated by the workflow.

```yaml
safe-outputs:
  create-pull-request:
```

or with further configuration:

```yaml
safe-outputs:
  create-pull-request:
    title-prefix: "[ai] "           # Optional: prefix for PR titles
    labels: [automation, ai-agent]  # Optional: labels to attach to PRs
    draft: true                     # Optional: create as draft PR (defaults to true)
```

The agentic part of your workflow should instruct to 
1. **Make code changes**: Make any code changes in the working directoryâ€”these are automatically collected using `git add -A` and committed
2. **Create a pull request**: Describe the pull request title and body you want

**Example natural language to generate the output:**

```markdown
# Code Improvement Agent

Analyze the latest commit and suggest improvements.

1. Make any file changes directly in the working directory
2. Create a PR with title "First change" and description "THis is a first change"
```

### Label Addition (`add-issue-labels:`)

Adding `add-issue-labels:` to the `safe-outputs:` section of your workflow declares that the workflow should conclude with adding labels to the current issue or pull request based on the agent's analysis.

```yaml
safe-outputs:
  add-issue-labels:
```

or with further configuration:

```yaml
safe-outputs:
  add-issue-labels:
    allowed: [triage, bug, enhancement] # Optional: allowed labels for addition.
    max-count: 3                        # Optional: maximum number of labels to add (default: 3)
```

The agentic part of your workflow should analyze the issue content and determine appropriate labels. 

**Example of natural language to generate the output:**

```markdown
# Issue Labeling Agent

Analyze the issue content and add appropriate labels to the issue.
```

The agentic part of your workflow will have implicit additional prompting saying that, to add labels to a GitHub issue, you must write labels to a special file, one label per line.

**Safety Features:**

- Empty lines in agent output are ignored
- Lines starting with `-` are rejected (no removal operations allowed)
- Duplicate labels are automatically removed
- If `allowed` is provided, all requested labels must be in the `allowed` list or the job fails with a clear error message. If `allowed` is not provided then any labels are allowed (including creating new labels).
- Label count is limited by `max-count` setting (default: 3) - exceeding this limit causes job failure
- Only GitHub's `issues.addLabels` API endpoint is used (no removal endpoints)

## Security and Sanitization

All agent output is automatically sanitized for security before being processed:

- **XML Character Escaping**: Special characters (`<`, `>`, `&`, `"`, `'`) are escaped to prevent injection attacks
- **URI Protocol Filtering**: Only HTTPS URIs are allowed; other protocols (HTTP, FTP, file://, javascript:, etc.) are replaced with "(redacted)"
- **Domain Allowlisting**: HTTPS URIs are checked against the `allowed-domains` list. Unlisted domains are replaced with "(redacted)"
- **Default Allowed Domains**: When `allowed-domains` is not specified, safe GitHub domains are used by default:
  - `github.com`
  - `github.io`
  - `githubusercontent.com`
  - `githubassets.com`
  - `github.dev`
  - `codespaces.new`
- **Length and Line Limits**: Content is truncated if it exceeds safety limits (0.5MB or 65,000 lines)
- **Control Character Removal**: Non-printable characters and ANSI escape sequences are stripped

**Configuration:**

```yaml
safe-outputs:
  allowed-domains:                    # Optional: domains allowed in agent output URIs
    - github.com                      # Default GitHub domains are always included
    - api.github.com                  # Additional trusted domains can be specified
    - trusted-domain.com              # URIs from unlisted domains are replaced with "(redacted)"
```

## Related Documentation

- [Frontmatter Options](frontmatter.md) - All configuration options for workflows
- [Workflow Structure](workflow-structure.md) - Directory layout and organization
- [Alias Triggers](alias-triggers.md) - Special @mention triggers and context text
- [Commands](commands.md) - CLI commands for workflow management

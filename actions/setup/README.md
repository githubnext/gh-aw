# Setup Action

This action copies workflow script files to the agent environment.

## Description

This action runs in all workflow jobs to provide JavaScript scripts that can be required instead of being inlined in the workflow. This includes scripts for activation jobs, agent jobs, and safe-output jobs.

The action copies 117 `.cjs` JavaScript files from the `js/` directory to a destination directory (default: `/tmp/gh-aw/actions`). These files are generated by running `make actions-build` and are committed to the repository.

## Usage

```yaml
- name: Setup Scripts
  uses: ./actions/setup
  with:
    # Destination directory for script files
    # Default: /tmp/gh-aw/actions
    destination: /tmp/gh-aw/actions
```

## Inputs

### `destination`

**Optional** Destination directory for script files.

Default: `/tmp/gh-aw/actions`

## Outputs

### `files-copied`

The number of files copied to the destination directory (should be 117).

## Example

```yaml
steps:
  - uses: actions/checkout@v4
    with:
      sparse-checkout: |
        actions
  
  - name: Setup Scripts
    uses: ./actions/setup
    with:
      destination: /tmp/gh-aw/actions
```

## Files Included

This action copies 117 `.cjs` files from `actions/setup/js/`, including:

- Activation job scripts (check_stop_time, check_skip_if_match, check_command_position, etc.)
- Agent job scripts (compute_text, create_issue, create_pull_request, etc.)
- Safe output scripts (safe_outputs_*, safe_inputs_*, messages, etc.)
- Utility scripts (sanitize_*, validate_*, generate_*, etc.)

All files are copied from the committed `js/` directory which is populated by running `make actions-build` during development.

## Development

The `js/` directory contains generated JavaScript files created by `make actions-build`. These files are committed to the repository so that workflows using sparse checkout can access them without needing to rebuild.

To update the JavaScript files after modifying source files in `pkg/workflow/js/`:

```bash
make actions-build
git add actions/setup/js/
git commit -m "Update action JavaScript files"
```

## Testing Locally

You can test this action locally using the provided test script:

```bash
./test-setup-local.sh
```

This script will:
1. Check if `js/` directory exists (runs `make actions-build` if needed)
2. Run setup.sh with test configuration
3. Verify all files are copied correctly

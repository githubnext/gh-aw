{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://github.com/githubnext/gh-aw-copilots/schemas/agent-output.json",
  "title": "GitHub Agentic Workflows Agent Output",
  "description": "Schema for the agent output file generated by the collect_output step in GitHub Agentic Workflows. This file contains the validated output from AI agents, structured as SafeOutput items with any validation errors. The actual business logic validation (such as ensuring update-issue has at least one updateable field) is handled by the JavaScript validation code.",
  "type": "object",
  "properties": {
    "items": {
      "type": "array",
      "description": "Array of validated safe output items",
      "items": {
        "$ref": "#/$defs/SafeOutput"
      }
    },
    "errors": {
      "type": "array",
      "description": "Array of validation errors encountered during processing",
      "items": {
        "type": "string"
      }
    }
  },
  "required": ["items", "errors"],
  "additionalProperties": false,
  "$defs": {
    "SafeOutput": {
      "title": "Safe Output Item",
      "description": "Union type of all supported safe output entries",
      "oneOf": [
        {"$ref": "#/$defs/CreateIssueOutput"},
        {"$ref": "#/$defs/AddCommentOutput"},
        {"$ref": "#/$defs/CreatePullRequestOutput"},
        {"$ref": "#/$defs/AddLabelsOutput"},
        {"$ref": "#/$defs/UpdateIssueOutput"},
        {"$ref": "#/$defs/PushToPullRequestBranchOutput"},
        {"$ref": "#/$defs/CreatePullRequestReviewCommentOutput"},
        {"$ref": "#/$defs/CreateDiscussionOutput"},
        {"$ref": "#/$defs/MissingToolOutput"},
        {"$ref": "#/$defs/CreateCodeScanningAlertOutput"},
        {"$ref": "#/$defs/UpdateProjectOutput"},
        {"$ref": "#/$defs/NoOpOutput"}
      ]
    },
    "CreateIssueOutput": {
      "title": "Create Issue Output",
      "description": "Output for creating a GitHub issue",
      "type": "object",
      "properties": {
        "type": {
          "const": "create_issue"
        },
        "title": {
          "type": "string",
          "description": "Title of the issue to create",
          "minLength": 1
        },
        "body": {
          "type": "string",
          "description": "Body content of the issue",
          "minLength": 1
        },
        "labels": {
          "type": "array",
          "description": "Optional labels to add to the issue",
          "items": {
            "type": "string"
          }
        }
      },
      "required": ["type", "title", "body"],
      "additionalProperties": false
    },
    "AddCommentOutput": {
      "title": "Add Issue Comment Output",
      "description": "Output for adding a comment to an issue or pull request",
      "type": "object",
      "properties": {
        "type": {
          "const": "add_comment"
        },
        "body": {
          "type": "string",
          "description": "Comment body content",
          "minLength": 1
        }
      },
      "required": ["type", "body"],
      "additionalProperties": false
    },
    "CreatePullRequestOutput": {
      "title": "Create Pull Request Output",
      "description": "Output for creating a GitHub pull request",
      "type": "object",
      "properties": {
        "type": {
          "const": "create_pull_request"
        },
        "title": {
          "type": "string",
          "description": "Title of the pull request",
          "minLength": 1
        },
        "body": {
          "type": "string",
          "description": "Body content of the pull request",
          "minLength": 1
        },
        "branch": {
          "type": "string",
          "description": "Optional branch name for the pull request"
        },
        "labels": {
          "type": "array",
          "description": "Optional labels to add to the pull request",
          "items": {
            "type": "string"
          }
        }
      },
      "required": ["type", "title", "body"],
      "additionalProperties": false
    },
    "AddLabelsOutput": {
      "title": "Add Issue Label Output",
      "description": "Output for adding labels to an issue or pull request",
      "type": "object",
      "properties": {
        "type": {
          "const": "add_labels"
        },
        "labels": {
          "type": "array",
          "description": "Array of label names to add",
          "items": {
            "type": "string"
          },
          "minItems": 1
        }
      },
      "required": ["type", "labels"],
      "additionalProperties": false
    },
    "UpdateIssueOutput": {
      "title": "Update Issue Output", 
      "description": "Output for updating an existing issue. Note: The JavaScript validation ensures at least one of status, title, or body is provided.",
      "type": "object",
      "properties": {
        "type": {
          "const": "update_issue"
        },
        "status": {
          "type": "string",
          "description": "New status for the issue",
          "enum": ["open", "closed"]
        },
        "title": {
          "type": "string",
          "description": "New title for the issue"
        },
        "body": {
          "type": "string",
          "description": "New body content for the issue"
        },
        "issue_number": {
          "oneOf": [
            {"type": "number"},
            {"type": "string"}
          ],
          "description": "Issue number to update (for target '*')"
        }
      },
      "required": ["type"],
      "additionalProperties": false
    },
    "PushToPullRequestBranchOutput": {
      "title": "Push to Branch Output",
      "description": "Output for pushing changes directly to a branch",
      "type": "object",
      "properties": {
        "type": {
          "const": "push_to_pull_request_branch"
        },
        "message": {
          "type": "string",
          "description": "Optional commit message"
        },
        "pull_request_number": {
          "oneOf": [
            {"type": "number"},
            {"type": "string"}
          ],
          "description": "Pull request number (for target '*')"
        }
      },
      "required": ["type"],
      "additionalProperties": false
    },
    "CreatePullRequestReviewCommentOutput": {
      "title": "Create Pull Request Review Comment Output",
      "description": "Output for creating a review comment on a specific line of code",
      "type": "object",
      "properties": {
        "type": {
          "const": "create_pull_request_review_comment"
        },
        "path": {
          "type": "string",
          "description": "File path for the comment",
          "minLength": 1
        },
        "line": {
          "oneOf": [
            {"type": "number", "minimum": 1},
            {"type": "string", "pattern": "^[1-9][0-9]*$"}
          ],
          "description": "Line number for the comment"
        },
        "body": {
          "type": "string",
          "description": "Comment body content",
          "minLength": 1
        },
        "start_line": {
          "oneOf": [
            {"type": "number", "minimum": 1},
            {"type": "string", "pattern": "^[1-9][0-9]*$"}
          ],
          "description": "Optional start line for multi-line comments"
        },
        "side": {
          "type": "string",
          "description": "Side of the diff to comment on",
          "enum": ["LEFT", "RIGHT"]
        }
      },
      "required": ["type", "path", "line", "body"],
      "additionalProperties": false
    },
    "CreateDiscussionOutput": {
      "title": "Create Discussion Output",
      "description": "Output for creating a GitHub discussion",
      "type": "object",
      "properties": {
        "type": {
          "const": "create_discussion"
        },
        "title": {
          "type": "string",
          "description": "Title of the discussion",
          "minLength": 1
        },
        "body": {
          "type": "string", 
          "description": "Body content of the discussion",
          "minLength": 1
        }
      },
      "required": ["type", "title", "body"],
      "additionalProperties": false
    },
    "MissingToolOutput": {
      "title": "Missing Tool Output",
      "description": "Output for reporting missing tools or functionality",
      "type": "object",
      "properties": {
        "type": {
          "const": "missing_tool"
        },
        "tool": {
          "type": "string",
          "description": "Name of the missing tool",
          "minLength": 1
        },
        "reason": {
          "type": "string",
          "description": "Reason why the tool is needed",
          "minLength": 1
        },
        "alternatives": {
          "type": "string",
          "description": "Optional alternative suggestions"
        }
      },
      "required": ["type", "tool", "reason"],
      "additionalProperties": false
    },
    "CreateCodeScanningAlertOutput": {
      "title": "Create Code Scanning Alert Output",
      "description": "Output for generating SARIF repository security advisories",
      "type": "object",
      "properties": {
        "type": {
          "const": "create_code_scanning_alert"
        },
        "sarif": {
          "oneOf": [
            {"type": "object"},
            {"type": "string"}
          ],
          "description": "SARIF content as object or string"
        },
        "category": {
          "type": "string",
          "description": "Optional category for the code scanning alert"
        }
      },
      "required": ["type", "sarif"],
      "additionalProperties": false
    },
    "UpdateProjectOutput": {
      "title": "Update Project Output",
      "description": "Output for unified project operations: create projects, add items (issues/PRs/drafts), and update item fields",
      "type": "object",
      "properties": {
        "type": {
          "const": "update_project"
        },
        "project": {
          "type": "string",
          "description": "Project title, number, or GitHub project URL",
          "minLength": 1
        },
        "campaign_id": {
          "type": "string",
          "description": "Optional campaign ID for tracking (auto-generated if not provided). Format: slug-timestamp"
        },
        "content_type": {
          "type": "string",
          "enum": ["issue", "pull_request"],
          "description": "Type of content to add to the project board"
        },
        "content_number": {
          "oneOf": [
            {"type": "number"},
            {"type": "string"}
          ],
          "description": "Issue or PR number (preferred field)"
        },
        "issue": {
          "oneOf": [
            {"type": "number"},
            {"type": "string"}
          ],
          "description": "Issue number (legacy field, use content_number instead)"
        },
        "pull_request": {
          "oneOf": [
            {"type": "number"},
            {"type": "string"}
          ],
          "description": "PR number (legacy field, use content_number instead)"
        },
        "fields": {
          "type": "object",
          "description": "Custom project field values to set/update. Creates fields if missing.",
          "additionalProperties": true
        }
      },
      "required": ["type", "project"],
      "additionalProperties": false
    },
    "NoOpOutput": {
      "title": "No-Op Output",
      "description": "Output for logging a message without taking any GitHub actions. Always available as a fallback to ensure human-visible artifacts.",
      "type": "object",
      "properties": {
        "type": {
          "const": "noop"
        },
        "message": {
          "type": "string",
          "description": "Message to log for transparency",
          "minLength": 1
        }
      },
      "required": ["type", "message"],
      "additionalProperties": false
    }
  }
}
---
on:
  workflow_dispatch:
  workflow_run:
    workflows: ["*"]
    types: [completed]

safe-outputs:
  missing-tool:
    max: 5
  staged: true

engine:
  id: custom
  steps:
    - name: Generate Missing Tool Safe Output
      run: |
        echo '{"type": "missing-tool", "tool": "example-missing-tool", "reason": "This is a test of the missing-tool safe output functionality. No actual tool is missing.", "alternatives": "This is a simulated missing tool report generated by the custom engine test workflow.", "context": "test-safe-output-missing-tool workflow validation"}' >> $GITHUB_AW_SAFE_OUTPUTS
        
        # Generate a second missing tool report to test the max limit
        echo '{"type": "missing-tool", "tool": "another-test-tool", "reason": "Testing multiple missing tool reports in a single workflow run.", "alternatives": "Mock alternatives for testing purposes.", "context": "Secondary test entry for validation"}' >> $GITHUB_AW_SAFE_OUTPUTS
        
    - name: Verify Safe Output File
      run: |
        echo "Generated safe output entries:"
        if [ -f "$GITHUB_AW_SAFE_OUTPUTS" ]; then
          cat "$GITHUB_AW_SAFE_OUTPUTS"
        else
          echo "No safe outputs file found"
        fi

permissions: read-all
---

# Test Safe Output - Missing Tool

This workflow tests the `missing-tool` safe output functionality using a custom engine that directly writes to the safe output file.

## Purpose

This workflow validates the missing-tool safe output type by:
- Generating JSON entries with the `missing-tool` type
- Including all required fields: tool, reason, alternatives, context
- Using staged mode to prevent actual GitHub interactions
- Demonstrating custom engine safe output writing for missing tool reports
- Testing multiple missing tool reports within the configured limit

## Trigger Events

- **workflow_dispatch**: Manual execution for testing
- **workflow_run**: Responds to any workflow completion (useful for detecting missing tools after other workflows)

## Safe Output Configuration

- **staged: true**: Prevents real GitHub interactions
- **max: 5**: Allows up to 5 missing tool reports per workflow run

## Custom Engine Implementation

The workflow uses a custom engine with GitHub Actions steps to:
1. Generate multiple missing-tool JSON outputs for testing
2. Include all required fields (tool, reason, alternatives, context)
3. Test the maximum limit functionality
4. Append entries to the $GITHUB_AW_SAFE_OUTPUTS file
5. Verify the outputs were generated correctly

This demonstrates how custom engines can leverage the safe output system for reporting missing tools or functionality that prevents task completion, helping users understand workflow limitations.
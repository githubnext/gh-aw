---
on:
  workflow_dispatch:
    inputs:
      data_source:
        description: "Data source description (e.g., 'repository statistics', 'workflow metrics')"
        required: false
        default: "sample data"
      chart_type:
        description: "Type of chart to generate (e.g., 'bar', 'line', 'scatter', 'pie')"
        required: false
        default: "bar"
permissions:
  contents: read
  actions: read
  issues: read
  pull-requests: read
engine: copilot
tools:
  edit:
imports:
  - shared/python-dataviz.md
safe-outputs:
  create-discussion:
    category: "artifacts"
    max: 1
timeout_minutes: 15
---

# Python Data Visualization Generator

You are a data visualization expert specializing in Python-based chart generation using scientific computing libraries.

## Mission

Generate high-quality data visualizations based on the provided data source, upload charts as assets, archive source files, and create a discussion with links to the generated visualizations.

## Current Context

- **Repository**: ${{ github.repository }}
- **Run ID**: ${{ github.run_id }}
- **Data Source**: ${{ github.event.inputs.data_source }}
- **Chart Type**: ${{ github.event.inputs.chart_type }}

## Environment

The Python data visualization environment has been set up with:
- **Libraries**: NumPy, Pandas, Matplotlib, Seaborn, SciPy
- **Working Directory**: `/tmp/gh-aw/python/`
- **Data Directory**: `/tmp/gh-aw/python/data/`
- **Charts Directory**: `/tmp/gh-aw/python/charts/`
- **Cache Memory**: `/tmp/gh-aw/cache-memory/`

See the shared Python Data Visualization Guide (imported above) for detailed usage instructions, best practices, and examples.

## Task Overview

### Phase 1: Data Collection

**CRITICAL: Data must NEVER be inlined in code**

1. Based on the data source input ("${{ github.event.inputs.data_source }}"), collect appropriate data:
   - For "repository statistics": Use GitHub API to fetch repository data
   - For "workflow metrics": Use GitHub Actions API to fetch workflow run data
   - For "sample data": Generate sample datasets using NumPy
   - For other sources: Determine appropriate data collection method

2. Save all collected data to `/tmp/gh-aw/python/data/` as CSV or JSON files

3. Document the data in `/tmp/gh-aw/python/data/README.md`

### Phase 2: Chart Generation

1. Check `/tmp/gh-aw/cache-memory/` for reusable helper functions

2. Create Python scripts in `/tmp/gh-aw/python/`:
   - Main script: `generate_chart.py`
   - Helper utilities as needed (and save to cache)

3. Load data from external files (NEVER inline):
   ```python
   import pandas as pd
   data = pd.read_csv('/tmp/gh-aw/python/data/data.csv')
   ```

4. Generate the requested chart type with high quality settings (DPI 300)

5. Save chart to `/tmp/gh-aw/python/charts/chart.png`

### Phase 3: Discussion Report

Create a discussion using safe-outputs with the following structure:

**Title**: "ðŸ“Š Data Visualization Report - ${{ github.event.inputs.data_source }}"

**Content**:
```markdown
# ðŸ“Š Data Visualization Report

Generated on: [current date]

## Summary

This report contains data visualizations generated from **${{ github.event.inputs.data_source }}** using Python scientific computing libraries.

## Generated Charts

- **Chart Type**: ${{ github.event.inputs.chart_type }}
- **Data Source**: ${{ github.event.inputs.data_source }}
- **Generated**: [timestamp]

## Artifacts

### ðŸ“ˆ Charts Artifact
- **Artifact Name**: `data-charts`
- **Download URL**: https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }}
- **Contents**: PNG image files of generated charts
- **Retention**: 30 days

### ðŸ“¦ Source and Data Artifact
- **Artifact Name**: `python-source-and-data`
- **Download URL**: https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }}
- **Contents**: Python scripts, data files, and documentation
- **Retention**: 30 days

## Data Information

[Include data statistics and description]

## Reproduction Instructions

1. Download the `python-source-and-data` artifact
2. Extract the archive
3. Install dependencies: `pip install numpy pandas matplotlib seaborn scipy`
4. Run: `python generate_chart.py`

## Libraries Used

- NumPy: Array processing and numerical operations
- Pandas: Data manipulation and analysis
- Matplotlib: Chart generation
- Seaborn: Statistical data visualization
- SciPy: Scientific computing

## Workflow Run

- **Repository**: ${{ github.repository }}
- **Run ID**: ${{ github.run_id }}
- **Run URL**: https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }}

---

*This report was automatically generated by the Python Data Visualization Generator workflow.*
```

## Key Reminders

- âœ… **Data Separation**: Always load data from external files, never inline
- âœ… **Cache Memory**: Check and save reusable helpers to `/tmp/gh-aw/cache-memory/`
- âœ… **High Quality**: Use DPI 300, clear labels, and seaborn styling
- âœ… **Artifacts**: Files are automatically uploaded to the configured artifacts

Refer to the Python Data Visualization Guide (imported above) for complete examples, code patterns, and best practices.


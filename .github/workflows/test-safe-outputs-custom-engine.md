---
name: Test Safe Outputs Custom Engine
description: Test workflow to verify safe-outputs functionality with custom engine
on:
  schedule: daily
  workflow_dispatch:
  push:
    branches:
      - main
    paths:
      - '.github/workflows/test-safe-outputs-custom-engine.md'

permissions:
  contents: read

engine:
  id: custom
  steps:
    - name: Create agent output with issue request
      run: |
        # Create the agent output directory
        mkdir -p /tmp/gh-aw/sandbox/agent/logs
        
        # Create NDJSON formatted output with create_issue request
        # The body uses escaped quotes and newlines in JSON
        cat > /tmp/gh-aw/sandbox/agent/logs/agent_output.json << 'EOF'
        {"type": "create_issue", "title": "[Custom Engine Test] Test Issue Created by Custom Engine", "body": "# Test Issue Created by Custom Engine\n\nThis issue was automatically created by the test-safe-outputs-custom-engine workflow to validate the create-issue safe output functionality.\n\n**Test Details:**\n- Engine: Custom\n- Trigger: ${{ github.event_name }}\n- Repository: ${{ github.repository }}\n- Run ID: ${{ github.run_id }}\n\nThis is a test issue and can be closed after verification.\n\n> Generated by Agentic Workflow Run <a href=\"${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}\">${{ github.run_id }}</a>", "labels": ["test-safe-outputs", "custom-engine", "automation"]}
        EOF
        
        echo "âœ… Agent output created at /tmp/gh-aw/sandbox/agent/logs/agent_output.json"
        echo "Content:"
        cat /tmp/gh-aw/sandbox/agent/logs/agent_output.json

safe-outputs:
  create-issue:
    labels: [test-safe-outputs, custom-engine, automation]

timeout-minutes: 5
strict: true
---

# Test Safe Outputs with Custom Engine

This is a deterministic test workflow that uses the custom engine (no AI) to test the safe-outputs `create-issue` functionality.

The workflow:
1. Creates an agent output file in NDJSON format with a `create_issue` request
2. The safe-outputs system processes this output file
3. A GitHub issue is created based on the request
4. Validates that safe-outputs work correctly with custom engines (no AI interpretation needed)
